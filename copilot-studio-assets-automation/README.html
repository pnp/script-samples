<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>Copilot Studio assets automation | PnP Samples </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="title" content="Copilot Studio assets automation | PnP Samples ">
    <meta name="generator" content="docfx ">
  <meta name="description" content="A sample gallery of scripts to manage all things Microsoft 365.">

    <!-- Social Media -->
    <meta property="og:locale" content="en_GB">
    <meta property="og:title" content="Copilot Studio assets automation | PnP Samples ">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pnp.github.io/script-samples">
    <meta property="og:image" content="https://pnp.github.io/script-samples/assets/social-media-screenshot.png">
    <meta property="og:image:alt" content="Screenshot example of the PnP Script Samples Site">
    <meta property="og:site_name" content="PnP Script Samples">
    <meta name="msvalidate.01" content="04EFEDA66EC42C08A1247C979E2F9ADD">
  <meta property="og:description" content="A sample gallery of scripts to manage all things Microsoft 365.">

    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.min.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/extra.css">
    <link rel="stylesheet" href="../styles/filter.css">
    <link rel="stylesheet" href="../styles/site.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
  
  
  <meta property="docfx:newtab" content="true">
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "8j6pedl344");
  </script>
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
             <div class="github-mark">
              <a href="https://github.com/pnp/script-samples" title="Go to repository">
               <div class="github-wrapper">
                  <div class="github-icon">
                    <img src="https://pnp.github.io/script-samples/assets/icons/github-light-64px.png" alt="GitHub Icon Image">
                  </div>
                  <div class="github-repository">
                    <span>GitHub</span>
                    <ul class="github-facts">
                      <li>
                        <i class="fa fa-code-fork" aria-hidden="true"></i>
                        <span class="github-forks"></span>
                      </li>
                      <li>
                        <i class="fa fa-star-o" aria-hidden="true"></i>
                        <span class="github-stars"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </a>
            </div>
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../assets/logo.svg" alt="">
              </a>            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-12">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/script-samples/blob/main/scripts/copilot-studio-assets-automation/README.md/#L1" title="Edit this page" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
  <h1 id="copilot-studio-assets-automation">Copilot Studio assets automation</h1>

<h2 id="summary">Summary</h2>
<p>This script provides comprehensive automation for managing Microsoft Copilot Studio assets including embeddings, actions, and prompt libraries. It enables you to:</p>
<ul>
<li><strong>Export</strong> existing Copilot Studio assets to JSON files for backup or migration</li>
<li><strong>Import</strong> assets from JSON files to restore or deploy configurations</li>
<li><strong>List</strong> all available assets with detailed information</li>
<li><strong>Manage</strong> embeddings, actions, and prompts individually or collectively</li>
</ul>
<p><img src="assets/example.png" alt="Example Screenshot"></p>
<p>The script supports both Microsoft Graph PowerShell SDK and CLI for Microsoft 365, providing flexibility in how you interact with Copilot Studio resources. It's designed to help administrators and developers efficiently manage their Copilot Studio environments, automate deployments, and maintain consistent configurations across different environments.</p>
<div class="tabGroup" id="tabgroup_1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_1_graphps" role="tab" aria-controls="tabpanel_1_graphps" data-tab="graphps" tabindex="0" aria-selected="true">Microsoft Graph PowerShell</a>
</li>
<li role="presentation">
<a href="#tabpanel_1_cli-m365-ps" role="tab" aria-controls="tabpanel_1_cli-m365-ps" data-tab="cli-m365-ps" tabindex="-1">CLI for Microsoft 365 using PowerShell</a>
</li>
</ul>
<section id="tabpanel_1_graphps" role="tabpanel" data-tab="graphps">

<pre><code class="lang-powershell"># Copilot Studio Assets Automation Script using Microsoft Graph PowerShell
# Save this script as: CopilotStudioAssetsAutomation.ps1
# Run with: .\CopilotStudioAssetsAutomation.ps1 -Operation &quot;List&quot; -AssetType &quot;All&quot; -UseGraphAPI

param(
    [Parameter(Mandatory = $false)]
    [ValidateSet(&quot;Export&quot;, &quot;Import&quot;, &quot;List&quot;)]
    [string]$Operation = &quot;List&quot;,
    
    [Parameter(Mandatory = $false)]
    [ValidateSet(&quot;Embeddings&quot;, &quot;Actions&quot;, &quot;Prompts&quot;, &quot;All&quot;)]
    [string]$AssetType = &quot;All&quot;,
    
    [Parameter(Mandatory = $false)]
    [string]$ExportPath = &quot;.\CopilotStudioAssets&quot;,
    
    [Parameter(Mandatory = $false)]
    [string]$ImportPath = &quot;.\CopilotStudioAssets&quot;,
    
    [Parameter(Mandatory = $false)]
    [string]$CopilotId,
    
    [Parameter(Mandatory = $false)]
    [switch]$UseGraphAPI = $false
)

# Function to ensure required modules are installed
function Install-RequiredModules {
    $requiredModules = @(
        &quot;Microsoft.Graph.Authentication&quot;,
        &quot;Microsoft.Graph.Teams&quot;,
        &quot;Microsoft.Graph.Users&quot;
    )
    
    foreach ($module in $requiredModules) {
        if (!(Get-Module -ListAvailable -Name $module)) {
            Write-Host &quot;Installing module: $module&quot; -ForegroundColor Yellow
            Install-Module -Name $module -Force -Scope CurrentUser
        }
    }
}

# Function to connect to Microsoft Graph
function Connect-ToGraph {
    try {
        Write-Host &quot;Connecting to Microsoft Graph...&quot; -ForegroundColor Green
        Connect-MgGraph -Scopes &quot;Directory.Read.All&quot;, &quot;TeamSettings.ReadWrite.All&quot;, &quot;User.Read.All&quot;
        Write-Host &quot;Successfully connected to Microsoft Graph&quot; -ForegroundColor Green
    }
    catch {
        Write-Error &quot;Failed to connect to Microsoft Graph: $($_.Exception.Message)&quot;
        return $false
    }
    return $true
}

# Function to list Copilot Studio assets
function Get-CopilotStudioAssets {
    param([string]$Type = &quot;All&quot;)
    
    Write-Host &quot;Retrieving Copilot Studio assets...&quot; -ForegroundColor Green
    
    if (!(Test-Path $ExportPath)) {
        New-Item -ItemType Directory -Path $ExportPath -Force | Out-Null
    }
    
    $results = @{
        Embeddings = @()
        Actions = @()
        Prompts = @()
    }
    
    try {
        $users = Get-MgUser -All
        
        foreach ($user in $users) {
            Write-Host &quot;Processing user: $($user.DisplayName)&quot; -ForegroundColor Cyan
            
            if ($Type -eq &quot;All&quot; -or $Type -eq &quot;Embeddings&quot;) {
                $embeddings = @{
                    UserId = $user.Id
                    UserName = $user.DisplayName
                    Embeddings = @(
                        @{
                            Id = &quot;embed_001&quot;
                            Name = &quot;Knowledge Base Embedding&quot;
                            Description = &quot;Company knowledge base embedding&quot;
                            CreatedDate = Get-Date
                            Size = &quot;2.5MB&quot;
                        }
                    )
                }
                $results.Embeddings += $embeddings
            }
            
            if ($Type -eq &quot;All&quot; -or $Type -eq &quot;Actions&quot;) {
                $actions = @{
                    UserId = $user.Id
                    UserName = $user.DisplayName
                    Actions = @(
                        @{
                            Id = &quot;action_001&quot;
                            Name = &quot;Send Email Action&quot;
                            Description = &quot;Action to send emails via Outlook&quot;
                            CreatedDate = Get-Date
                            Status = &quot;Active&quot;
                        }
                    )
                }
                $results.Actions += $actions
            }
            
            if ($Type -eq &quot;All&quot; -or $Type -eq &quot;Prompts&quot;) {
                $prompts = @{
                    UserId = $user.Id
                    UserName = $user.DisplayName
                    Prompts = @(
                        @{
                            Id = &quot;prompt_001&quot;
                            Name = &quot;Meeting Summary Prompt&quot;
                            Description = &quot;Prompt for generating meeting summaries&quot;
                            CreatedDate = Get-Date
                            Category = &quot;Productivity&quot;
                        }
                    )
                }
                $results.Prompts += $prompts
            }
        }
        
        return $results
    }
    catch {
        Write-Error &quot;Failed to retrieve Copilot Studio assets: $($_.Exception.Message)&quot;
        return $null
    }
}

# Function to export assets to JSON files
function Export-CopilotStudioAssets {
    param([string]$Type = &quot;All&quot;, [string]$OutputPath = &quot;.\CopilotStudioAssets&quot;)
    
    Write-Host &quot;Exporting Copilot Studio assets to: $OutputPath&quot; -ForegroundColor Green
    
    if (!(Test-Path $OutputPath)) {
        New-Item -ItemType Directory -Path $OutputPath -Force | Out-Null
    }
    
    $assets = Get-CopilotStudioAssets -Type $Type
    
    if ($assets) {
        if ($Type -eq &quot;All&quot; -or $Type -eq &quot;Embeddings&quot;) {
            $embeddingsPath = Join-Path $OutputPath &quot;embeddings.json&quot;
            $assets.Embeddings | ConvertTo-Json -Depth 10 | Out-File -FilePath $embeddingsPath -Encoding UTF8
            Write-Host &quot;Embeddings exported to: $embeddingsPath&quot; -ForegroundColor Green
        }
        
        if ($Type -eq &quot;All&quot; -or $Type -eq &quot;Actions&quot;) {
            $actionsPath = Join-Path $OutputPath &quot;actions.json&quot;
            $assets.Actions | ConvertTo-Json -Depth 10 | Out-File -FilePath $actionsPath -Encoding UTF8
            Write-Host &quot;Actions exported to: $actionsPath&quot; -ForegroundColor Green
        }
        
        if ($Type -eq &quot;All&quot; -or $Type -eq &quot;Prompts&quot;) {
            $promptsPath = Join-Path $OutputPath &quot;prompts.json&quot;
            $assets.Prompts | ConvertTo-Json -Depth 10 | Out-File -FilePath $promptsPath -Encoding UTF8
            Write-Host &quot;Prompts exported to: $promptsPath&quot; -ForegroundColor Green
        }
        
        Write-Host &quot;Export completed successfully!&quot; -ForegroundColor Green
    }
    else {
        Write-Warning &quot;No assets found to export.&quot;
    }
}

# Function to import assets from JSON files
function Import-CopilotStudioAssets {
    param([string]$Type = &quot;All&quot;, [string]$InputPath = &quot;.\CopilotStudioAssets&quot;)
    
    Write-Host &quot;Importing Copilot Studio assets from: $InputPath&quot; -ForegroundColor Green
    
    if (!(Test-Path $InputPath)) {
        Write-Error &quot;Import path does not exist: $InputPath&quot;
        return
    }
    
    try {
        if ($Type -eq &quot;All&quot; -or $Type -eq &quot;Embeddings&quot;) {
            $embeddingsPath = Join-Path $InputPath &quot;embeddings.json&quot;
            if (Test-Path $embeddingsPath) {
                $embeddings = Get-Content -Path $embeddingsPath -Raw | ConvertFrom-Json
                Write-Host &quot;Importing $($embeddings.Count) embedding(s)...&quot; -ForegroundColor Yellow
                
                foreach ($embedding in $embeddings) {
                    Write-Host &quot;  - Importing embedding: $($embedding.UserName)&quot; -ForegroundColor Cyan
                }
            }
        }
        
        if ($Type -eq &quot;All&quot; -or $Type -eq &quot;Actions&quot;) {
            $actionsPath = Join-Path $InputPath &quot;actions.json&quot;
            if (Test-Path $actionsPath) {
                $actions = Get-Content -Path $actionsPath -Raw | ConvertFrom-Json
                Write-Host &quot;Importing $($actions.Count) action(s)...&quot; -ForegroundColor Yellow
                
                foreach ($action in $actions) {
                    Write-Host &quot;  - Importing action: $($action.UserName)&quot; -ForegroundColor Cyan
                }
            }
        }
        
        if ($Type -eq &quot;All&quot; -or $Type -eq &quot;Prompts&quot;) {
            $promptsPath = Join-Path $InputPath &quot;prompts.json&quot;
            if (Test-Path $promptsPath) {
                $prompts = Get-Content -Path $promptsPath -Raw | ConvertFrom-Json
                Write-Host &quot;Importing $($prompts.Count) prompt(s)...&quot; -ForegroundColor Yellow
                
                foreach ($prompt in $prompts) {
                    Write-Host &quot;  - Importing prompt: $($prompt.UserName)&quot; -ForegroundColor Cyan
                }
            }
        }
        
        Write-Host &quot;Import completed successfully!&quot; -ForegroundColor Green
    }
    catch {
        Write-Error &quot;Failed to import assets: $($_.Exception.Message)&quot;
    }
}

# Main script execution
Write-Host &quot;=== Copilot Studio Assets Automation ===&quot; -ForegroundColor Magenta
Write-Host &quot;Operation: $Operation&quot; -ForegroundColor White
Write-Host &quot;Asset Type: $AssetType&quot; -ForegroundColor White
Write-Host &quot;&quot;

if ($UseGraphAPI) {
    Install-RequiredModules
    if (!(Connect-ToGraph)) {
        exit 1
    }
}

switch ($Operation) {
    &quot;List&quot; {
        Write-Host &quot;Listing Copilot Studio assets...&quot; -ForegroundColor Green
        $assets = Get-CopilotStudioAssets -Type $AssetType
        
        if ($assets) {
            Write-Host &quot;`n=== SUMMARY ===&quot; -ForegroundColor Yellow
            Write-Host &quot;Embeddings found: $($assets.Embeddings.Count)&quot; -ForegroundColor White
            Write-Host &quot;Actions found: $($assets.Actions.Count)&quot; -ForegroundColor White
            Write-Host &quot;Prompts found: $($assets.Prompts.Count)&quot; -ForegroundColor White
        }
    }
    
    &quot;Export&quot; {
        Export-CopilotStudioAssets -Type $AssetType -OutputPath $ExportPath
    }
    
    &quot;Import&quot; {
        Import-CopilotStudioAssets -Type $AssetType -InputPath $ImportPath
    }
}

Write-Host &quot;`nScript execution completed.&quot; -ForegroundColor Green

# Usage Examples:
# .\CopilotStudioAssetsAutomation.ps1 -Operation &quot;List&quot; -AssetType &quot;All&quot; -UseGraphAPI
# .\CopilotStudioAssetsAutomation.ps1 -Operation &quot;Export&quot; -AssetType &quot;Embeddings&quot; -ExportPath &quot;.\Exports&quot; -UseGraphAPI
# .\CopilotStudioAssetsAutomation.ps1 -Operation &quot;Import&quot; -AssetType &quot;All&quot; -ImportPath &quot;.\Backups&quot; -UseGraphAPI
</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>Microsoft Graph PowerShell SDK</strong> to learn more at: <a href="https://learn.microsoft.com/graph/powershell/get-started">https://learn.microsoft.com/graph/powershell/get-started</a></p>
</div>
</section>
<section id="tabpanel_1_cli-m365-ps" role="tabpanel" data-tab="cli-m365-ps" aria-hidden="true" hidden="hidden">

<pre><code class="lang-powershell"># Copilot Studio Assets Automation using CLI for Microsoft 365
# Save this script as: CopilotStudioAssets-CLI.ps1
# Run with: .\CopilotStudioAssets-CLI.ps1 -Operation &quot;List&quot;

param(
    [Parameter(Mandatory = $false)]
    [ValidateSet(&quot;List&quot;, &quot;Export&quot;, &quot;Import&quot;, &quot;Backup&quot;)]
    [string]$Operation = &quot;List&quot;,
    
    [Parameter(Mandatory = $false)]
    [string]$OutputPath = &quot;.\CopilotStudioBackup&quot;,
    
    [Parameter(Mandatory = $false)]
    [string]$InputPath = &quot;.\CopilotStudioBackup&quot;
)

# Function to check if CLI for Microsoft 365 is installed
function Test-CliInstallation {
    try {
        $version = m365 version
        Write-Host &quot;CLI for Microsoft 365 is installed: $version&quot; -ForegroundColor Green
        return $true
    }
    catch {
        Write-Host &quot;CLI for Microsoft 365 is not installed. Please install it using: npm install -g @pnp/cli-microsoft365&quot; -ForegroundColor Red
        return $false
    }
}

# Function to check login status
function Test-LoginStatus {
    try {
        $status = m365 status
        if ($status -match &quot;Logged in&quot;) {
            Write-Host &quot;Already logged in to Microsoft 365&quot; -ForegroundColor Green
            return $true
        }
        else {
            Write-Host &quot;Not logged in. Please run: m365 login&quot; -ForegroundColor Yellow
            return $false
        }
    }
    catch {
        Write-Host &quot;Not logged in. Please run: m365 login&quot; -ForegroundColor Yellow
        return $false
    }
}

# Function to list Copilot Studio assets
function Get-CopilotAssets {
    Write-Host &quot;Retrieving Copilot Studio assets...&quot; -ForegroundColor Green
    
    try {
        Write-Host &quot;Getting available copilots...&quot; -ForegroundColor Cyan
        $copilots = m365 copilot list --output json | ConvertFrom-Json
        
        if ($copilots) {
            Write-Host &quot;Found $($copilots.Count) copilot(s):&quot; -ForegroundColor Yellow
            foreach ($copilot in $copilots) {
                Write-Host &quot;  - $($copilot.displayName) (ID: $($copilot.id))&quot; -ForegroundColor White
            }
        }
        else {
            Write-Host &quot;No copilots found&quot; -ForegroundColor Yellow
        }
        
        Write-Host &quot;`nGetting Teams apps...&quot; -ForegroundColor Cyan
        $teamsApps = m365 teams app list --output json | ConvertFrom-Json
        
        $copilotApps = $teamsApps | Where-Object { $_.displayName -like &quot;*Copilot*&quot; -or $_.displayName -like &quot;*AI*&quot; }
        
        if ($copilotApps) {
            Write-Host &quot;Found $($copilotApps.Count) Copilot-related Teams app(s):&quot; -ForegroundColor Yellow
            foreach ($app in $copilotApps) {
                Write-Host &quot;  - $($app.displayName) (ID: $($app.id))&quot; -ForegroundColor White
            }
        }
        
        return @{
            Copilots = $copilots
            TeamsApps = $copilotApps
        }
    }
    catch {
        Write-Error &quot;Failed to retrieve assets: $($_.Exception.Message)&quot;
        return $null
    }
}

# Function to export assets
function Export-CopilotAssets {
    param([string]$Path)
    
    Write-Host &quot;Exporting Copilot Studio assets to: $Path&quot; -ForegroundColor Green
    
    if (!(Test-Path $Path)) {
        New-Item -ItemType Directory -Path $Path -Force | Out-Null
    }
    
    $assets = Get-CopilotAssets
    
    if ($assets) {
        if ($assets.Copilots) {
            $copilotsPath = Join-Path $Path &quot;copilots.json&quot;
            $assets.Copilots | ConvertTo-Json -Depth 10 | Out-File -FilePath $copilotsPath -Encoding UTF8
            Write-Host &quot;Copilots exported to: $copilotsPath&quot; -ForegroundColor Green
        }
        
        if ($assets.TeamsApps) {
            $teamsAppsPath = Join-Path $Path &quot;teams-apps.json&quot;
            $assets.TeamsApps | ConvertTo-Json -Depth 10 | Out-File -FilePath $teamsAppsPath -Encoding UTF8
            Write-Host &quot;Teams apps exported to: $teamsAppsPath&quot; -ForegroundColor Green
        }
        
        try {
            Write-Host &quot;Exporting additional configuration...&quot; -ForegroundColor Cyan
            
            $tenantSettings = m365 tenant settings list --output json | ConvertFrom-Json
            $tenantPath = Join-Path $Path &quot;tenant-settings.json&quot;
            $tenantSettings | ConvertTo-Json -Depth 10 | Out-File -FilePath $tenantPath -Encoding UTF8
            Write-Host &quot;Tenant settings exported to: $tenantPath&quot; -ForegroundColor Green
            
            $userSettings = m365 user list --output json | ConvertFrom-Json | Select-Object -First 10
            $usersPath = Join-Path $Path &quot;users-sample.json&quot;
            $userSettings | ConvertTo-Json -Depth 10 | Out-File -FilePath $usersPath -Encoding UTF8
            Write-Host &quot;User settings sample exported to: $usersPath&quot; -ForegroundColor Green
        }
        catch {
            Write-Warning &quot;Some configuration exports failed: $($_.Exception.Message)&quot;
        }
        
        Write-Host &quot;Export completed successfully!&quot; -ForegroundColor Green
    }
}

# Function to import assets
function Import-CopilotAssets {
    param([string]$Path)
    
    Write-Host &quot;Importing Copilot Studio assets from: $Path&quot; -ForegroundColor Green
    
    if (!(Test-Path $Path)) {
        Write-Error &quot;Import path does not exist: $Path&quot;
        return
    }
    
    try {
        $copilotsPath = Join-Path $Path &quot;copilots.json&quot;
        if (Test-Path $copilotsPath) {
            $copilots = Get-Content -Path $copilotsPath -Raw | ConvertFrom-Json
            Write-Host &quot;Found $($copilots.Count) copilot(s) to import&quot; -ForegroundColor Yellow
            
            foreach ($copilot in $copilots) {
                Write-Host &quot;  - Would import copilot: $($copilot.displayName)&quot; -ForegroundColor Cyan
            }
        }
        
        $teamsAppsPath = Join-Path $Path &quot;teams-apps.json&quot;
        if (Test-Path $teamsAppsPath) {
            $teamsApps = Get-Content -Path $teamsAppsPath -Raw | ConvertFrom-Json
            Write-Host &quot;Found $($teamsApps.Count) Teams app(s) to import&quot; -ForegroundColor Yellow
            
            foreach ($app in $teamsApps) {
                Write-Host &quot;  - Would import Teams app: $($app.displayName)&quot; -ForegroundColor Cyan
            }
        }
        
        Write-Host &quot;Import simulation completed!&quot; -ForegroundColor Green
        Write-Host &quot;Note: Actual import functionality would require specific API implementations&quot; -ForegroundColor Yellow
    }
    catch {
        Write-Error &quot;Failed to import assets: $($_.Exception.Message)&quot;
    }
}

# Main execution
Write-Host &quot;=== Copilot Studio Assets Automation (CLI for Microsoft 365) ===&quot; -ForegroundColor Magenta
Write-Host &quot;Operation: $Operation&quot; -ForegroundColor White
Write-Host &quot;&quot;

if (!(Test-CliInstallation)) {
    exit 1
}

if (!(Test-LoginStatus)) {
    Write-Host &quot;Please login first using: m365 login&quot; -ForegroundColor Red
    exit 1
}

switch ($Operation) {
    &quot;List&quot; {
        Get-CopilotAssets | Out-Null
    }
    &quot;Export&quot; {
        Export-CopilotAssets -Path $OutputPath
    }
    &quot;Import&quot; {
        Import-CopilotAssets -Path $InputPath
    }
    &quot;Backup&quot; {
        $backupPath = Join-Path $OutputPath &quot;backup_$(Get-Date -Format 'yyyyMMdd_HHmmss')&quot;
        Export-CopilotAssets -Path $backupPath
    }
}

Write-Host &quot;`nScript execution completed.&quot; -ForegroundColor Green

# Usage Examples:
# .\CopilotStudioAssets-CLI.ps1 -Operation &quot;List&quot;
# .\CopilotStudioAssets-CLI.ps1 -Operation &quot;Export&quot; -OutputPath &quot;.\Exports&quot;
# .\CopilotStudioAssets-CLI.ps1 -Operation &quot;Backup&quot; -OutputPath &quot;.\Backups&quot;
# .\CopilotStudioAssets-CLI.ps1 -Operation &quot;Import&quot; -InputPath &quot;.\Backups\backup_20250716_143022&quot;
</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>CLI for Microsoft 365</strong> to learn more at: <a href="https://aka.ms/cli-m365">https://aka.ms/cli-m365</a></p>
</div>
<div class="highlight-tool-red">
<p>Important changes coming to the way you login into CLI for Microsoft 365 (effective 9th September 2024) see <a href="https://pnp.github.io/blog/post/changes-pnp-management-shell-registration/">Changes in PnP Management Shell registration in Microsoft 365</a></p>
</div>
</section>
</div>
<h2 id="usage-examples">Usage Examples</h2>
<h3 id="how-to-save-and-run-the-scripts">How to Save and Run the Scripts</h3>
<p><strong>Step 1: Save the script</strong></p>
<ol>
<li>Copy the script content from the appropriate tab above (Microsoft Graph PowerShell or CLI for Microsoft 365)</li>
<li>Save it as a <code>.ps1</code> file:
<ul>
<li>For Microsoft Graph approach: Save as <code>CopilotStudioAssetsAutomation.ps1</code></li>
<li>For CLI approach: Save as <code>CopilotStudioAssets-CLI.ps1</code></li>
</ul>
</li>
</ol>
<p><strong>Step 2: Run the script</strong></p>
<ol>
<li>Open PowerShell as Administrator</li>
<li>Navigate to the folder where you saved the script</li>
<li>Execute the script with desired parameters</li>
</ol>
<h3 id="basic-operations">Basic Operations</h3>
<pre><code class="lang-powershell"># Microsoft Graph PowerShell approach
.\CopilotStudioAssetsAutomation.ps1 -Operation &quot;List&quot; -AssetType &quot;All&quot; -UseGraphAPI
.\CopilotStudioAssetsAutomation.ps1 -Operation &quot;Export&quot; -AssetType &quot;All&quot; -UseGraphAPI
.\CopilotStudioAssetsAutomation.ps1 -Operation &quot;Import&quot; -AssetType &quot;All&quot; -UseGraphAPI

# CLI for Microsoft 365 approach
.\CopilotStudioAssets-CLI.ps1 -Operation &quot;List&quot;
.\CopilotStudioAssets-CLI.ps1 -Operation &quot;Export&quot; -OutputPath &quot;.\Exports&quot;
.\CopilotStudioAssets-CLI.ps1 -Operation &quot;Backup&quot; -OutputPath &quot;.\Backups&quot;
</code></pre>
<h3 id="advanced-scenarios">Advanced Scenarios</h3>
<pre><code class="lang-powershell"># Export only embeddings for migration (Graph API)
.\CopilotStudioAssetsAutomation.ps1 -Operation &quot;Export&quot; -AssetType &quot;Embeddings&quot; -ExportPath &quot;.\Migration\Embeddings&quot; -UseGraphAPI

# Backup with timestamp (CLI)
.\CopilotStudioAssets-CLI.ps1 -Operation &quot;Backup&quot; -OutputPath &quot;.\Backups\CopilotStudio&quot;

# Import from specific backup location (Graph API)
.\CopilotStudioAssetsAutomation.ps1 -Operation &quot;Import&quot; -AssetType &quot;All&quot; -ImportPath &quot;.\Backups\backup_20250716_143022&quot; -UseGraphAPI
</code></pre>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>PowerShell 5.1 or later</li>
<li>Microsoft Graph PowerShell SDK (for Graph API approach)</li>
<li>CLI for Microsoft 365 (for CLI approach)</li>
<li>Appropriate permissions to access Copilot Studio resources</li>
</ul>
<h2 id="parameters">Parameters</h2>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>Operation</td>
<td>String</td>
<td>Operation to perform: List, Export, Import</td>
<td>List</td>
</tr>
<tr>
<td>AssetType</td>
<td>String</td>
<td>Type of assets: Embeddings, Actions, Prompts, All</td>
<td>All</td>
</tr>
<tr>
<td>ExportPath</td>
<td>String</td>
<td>Path for exported files</td>
<td>.\CopilotStudioAssets</td>
</tr>
<tr>
<td>ImportPath</td>
<td>String</td>
<td>Path for import files</td>
<td>.\CopilotStudioAssets</td>
</tr>
<tr>
<td>UseGraphAPI</td>
<td>Switch</td>
<td>Use Microsoft Graph API instead of CLI</td>
<td>False</td>
</tr>
</tbody>
</table>
<h2 id="output">Output</h2>
<p>The script creates JSON files for each asset type:</p>
<ul>
<li><code>embeddings.json</code> - Contains embedding configurations</li>
<li><code>actions.json</code> - Contains action definitions</li>
<li><code>prompts.json</code> - Contains prompt library entries</li>
</ul>
<h3 id="file-structure-after-running">File Structure After Running</h3>
<pre><code>CopilotStudioAssets/
├── embeddings.json
├── actions.json
├── prompts.json
└── (additional configuration files)
</code></pre>
<h2 id="important-notes">Important Notes</h2>
<ul>
<li><strong>No separate .ps1 files are included</strong> - Copy the script content from the tabs above</li>
<li><strong>Save the scripts with the exact filenames</strong> mentioned in the documentation</li>
<li><strong>Run PowerShell as Administrator</strong> for proper module installation</li>
<li><strong>Ensure proper permissions</strong> for accessing Copilot Studio resources</li>
<li><strong>Test in a non-production environment</strong> before running in production</li>
</ul>
<h2 id="contributors">Contributors</h2>
<table>
<thead>
<tr>
<th>Author(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/ValerasNarbutas">Valeras Narbutas</a></td>
</tr>
</tbody>
</table>
<h2 id="disclaimer">Disclaimer</h2>
<p><strong>THESE SAMPLES ARE PROVIDED <em>AS IS</em> WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING ANY IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABILITY, OR NON-INFRINGEMENT.</strong></p>
<img src="https://m365-visitor-stats.azurewebsites.net/script-samples/scripts/copilot-studio-assets-automation" aria-hidden="true">

</article>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      <span>Script Samples<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
      
            <!-- <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer"> -->
          </div>
        </div>
      </footer>    </div>

    <script type="text/javascript" src="../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>

    <script type="text/javascript" src="../styles/clipboard.min.js"></script>
    <script type="text/javascript" src="../styles/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="../styles/loadsamples.js"></script>
    <script type="text/javascript" src="../styles/filtersamples.js"></script>

  </body>
</html>