<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <title>Bring you own data with Azure Open AI example | PnP Samples </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="title" content="Bring you own data with Azure Open AI example | PnP Samples ">
    <meta name="generator" content="docfx 2.56.7.0">
    <meta name="description" content="A sample gallery of scripts to manage all things Microsoft 365.">
  
    <!-- Social Media -->
    <meta property="og:locale" content="en_GB">
    <meta property="og:title" content="Bring you own data with Azure Open AI example | PnP Samples ">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pnp.github.io/script-samples">
    <meta property="og:image" content="https://pnp.github.io/script-samples/assets/social-media-screenshot.png">
    <meta property="og:image:alt" content="Screenshot example of the PnP Script Samples Site">
    <meta property="og:site_name" content="PnP Script Samples">
    <meta name="msvalidate.01" content="04EFEDA66EC42C08A1247C979E2F9ADD">
    <meta property="og:description" content="A sample gallery of scripts to manage all things Microsoft 365.">
  
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/extra.css">
    <link rel="stylesheet" href="../styles/filter.css">
    <link rel="stylesheet" href="../styles/site.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    <meta property="docfx:newtab" content="true">
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "8j6pedl344");
  </script>
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
             <div class="github-mark">
              <a href="https://github.com/pnp/script-samples" title="Go to repository">
               <div class="github-wrapper">
                  <div class="github-icon">
                    <img src="https://pnp.github.io/script-samples/assets/icons/github-light-64px.png" alt="GitHub Icon Image">
                  </div>
                  <div class="github-repository">
                    <span>GitHub</span>
                    <ul class="github-facts">
                      <li>
                        <i class="fa fa-code-fork" aria-hidden="true"></i>
                        <span class="github-forks"></span>
                      </li>
                      <li>
                        <i class="fa fa-star-o" aria-hidden="true"></i>
                        <span class="github-stars"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </a>
            </div>
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../assets/logo.svg" alt="">
              </a>    </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-12">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/script-samples/blob/main/scripts/azure-open-ai-byod-powershell/README.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="bring-you-own-data-with-azure-open-ai-example">Bring you own data with Azure Open AI example</h1>

<h2 id="summary">Summary</h2>
<p>In this example, I am calling the Azure Open AI service directly using PowerShell and including data sources (Azure Cognitive Search) with Semantic Search enabled, to show an example of how you can bring your own data to the Azure Open AI service.</p>
<p><img src="assets/example.png" alt="Example Screenshot"></p>
<p>In order to get started, you need:</p>
<ul>
<li>Azure Open AI service (please apply via form) and deployment of GPT 3.5 Model called &quot;gpt-35-turbo&quot; (or change the deployment name in the script)</li>
<li>Azure Blog Storage account with content, for my example, I loaded blob storage will all the samples from PnP Script Samples.</li>
<li>Azure Cognitive Search with Semantic Search enabled (free plan is fine)</li>
<li>Setup the Data Source, Index, and Indexer in Azure Cognitive Search</li>
</ul>
<p>Reference: <a href="https://learn.microsoft.com/azure/ai-services/openai/reference#completions-extensions">https://learn.microsoft.com/azure/ai-services/openai/reference#completions-extensions</a></p>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_ps" role="tab" aria-controls="tabpanel_CeZOj-G++Q_ps" data-tab="ps" tabindex="0" aria-selected="true">PowerShell</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_settings" role="tab" aria-controls="tabpanel_CeZOj-G++Q_settings" data-tab="settings" tabindex="-1">Settings File</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q_ps" role="tabpanel" data-tab="ps">

<pre><code class="lang-powershell">
# ---------------------------------------------------
# Lets keep our secrets and settings in a json file
# ---------------------------------------------------
$settings = Get-Content &quot;settings.json&quot; -Raw | ConvertFrom-Json

$azureOpenAIEndPoint  = $settings.AzureOpenAIEndPoint
$azureOpenAIKey = $settings.AzureOpenAIKey
$azureSearchAdminKey = $settings.AzureSearchAdminKey
$azureSearchEndPoint = $settings.AzureSearchEndPoint
$azureSearchIndexName = $settings.AzureSearchIndexName

# -------------------------------
# Adjustable EndPoint Parameters
# -------------------------------
$azureOpenAIDeploymentName = &quot;gpt-35-turbo&quot;
$azureOpenAIApiVersion = '2023-08-01-preview' #Important to use this version for chat completion extensions

# Quick Check
Write-Host &quot;Azure OpenAI EndPoint: $azureOpenAIEndPoint&quot;

#--------------------
# Build the Request
#--------------------
$systemMessage = &quot;This is a conversation with an AI assistant. The assistant is helpful, creative, clever, and very friendly.&quot;

# Authorisation to the service
$headers = [ordered]@{
    'api-key' = $azureOpenAIKey
}

# Messages and Chat History
$messages = @()
$messages += @{
  role = 'system'
  content = $systemMessage
}
$messages += @{
  role = 'user'
  content = &quot;Give me an example of use of a CAML query within a sample&quot;
}

$body = [ordered]@{
    max_tokens  = 150
    temperature = 0.9
    top_p       = 0.5
    dataSources = @(
        @{
            type = &quot;AzureCognitiveSearch&quot;
            parameters = [ordered]@{
                key = $azureSearchAdminKey
                indexName = $azureSearchIndexName
                endpoint = $azureSearchEndPoint
                queryType = &quot;semantic&quot;
                semanticConfiguration = &quot;default&quot;
                inScope = $true
                topNDocuments = &quot;5&quot;
            }
        }
    )
    messages = $messages
} | ConvertTo-Json -Depth 3

# https://learn.microsoft.com/azure/ai-services/openai/reference#completions-extensions
$url = &quot;$($azureOpenAIEndPoint)openai/deployments/$($azureOpenAIDeploymentName)/extensions/chat/completions?api-version=$($azureOpenAIApiVersion)&quot;

# Check the Input Json Bodies
#---------------------------------
$headers
$body

#--------------------
# Invoke the API
#--------------------
$response = Invoke-RestMethod -Uri $url -Headers $headers -Body $body -Method Post -ContentType 'application/json'

#--------------------
# Results
#--------------------
$response 

# Note the response body is different because Azure Open AI includes the citations from Azure Cognitive Search
$response.choices.message

# Output to file to see full response body
$response | ConvertTo-Json -Depth 10 | Out-File &quot;response.json&quot; -Force  

</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>PowerShell</strong> to learn more at: <a href="https://learn.microsoft.com/powershell">PowerShell Documentation | Microsoft Learn</a></p>
</div>
</section>
<section id="tabpanel_CeZOj-G++Q_settings" role="tabpanel" data-tab="settings" aria-hidden="true" hidden="hidden">

<pre><code class="lang-json">
{
    &quot;AzureOpenAIEndPoint&quot;: &quot;https://&lt;instance&gt;.openai.azure.com/&quot;,
    &quot;AzureOpenAIKey&quot;: &quot;...&quot;,
    &quot;AzureSearchAdminKey&quot;: &quot;...&quot;,
    &quot;AzureSearchEndPoint&quot;: &quot;https://&lt;instance&gt;.search.windows.net&quot;,
    &quot;AzureSearchIndexName&quot;: &quot;&lt;index&gt;&quot;
}

</code></pre>
</section>
</div>
<h2 id="contributors">Contributors</h2>
<table>
<thead>
<tr>
<th>Author(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Paul Bullock</td>
</tr>
</tbody>
</table>
<h2 id="disclaimer">Disclaimer</h2>
<p><strong>THESE SAMPLES ARE PROVIDED <em>AS IS</em> WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING ANY IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABILITY, OR NON-INFRINGEMENT.</strong></p>
<img src="https://m365-visitor-stats.azurewebsites.net/script-samples/scripts/azure-open-ai-byod-powershell" aria-hidden="true">
</article>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Script Samples<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
            <!-- <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer"> -->
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    
    <script type="text/javascript" src="../styles/clipboard.min.js"></script>
    <script type="text/javascript" src="../styles/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="../styles/loadsamples.js"></script>
    <script type="text/javascript" src="../styles/filtersamples.js"></script>

  </body>
</html>