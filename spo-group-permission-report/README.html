<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <title>Get permission group report of a site | PnP Samples </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="title" content="Get permission group report of a site | PnP Samples ">
    <meta name="generator" content="docfx 2.56.7.0">
    <meta name="description" content="A sample gallery of scripts to manage all things Microsoft 365.">
  
    <!-- Social Media -->
    <meta property="og:locale" content="en_GB">
    <meta property="og:title" content="Get permission group report of a site | PnP Samples ">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pnp.github.io/script-samples">
    <meta property="og:image" content="https://pnp.github.io/script-samples/assets/social-media-screenshot.png">
    <meta property="og:image:alt" content="Screenshot example of the PnP Script Samples Site">
    <meta property="og:site_name" content="PnP Script Samples">
    <meta name="msvalidate.01" content="04EFEDA66EC42C08A1247C979E2F9ADD">
    <meta property="og:description" content="A sample gallery of scripts to manage all things Microsoft 365.">
  
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/extra.css">
    <link rel="stylesheet" href="../styles/filter.css">
    <link rel="stylesheet" href="../styles/site.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    <meta property="docfx:newtab" content="true">
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "8j6pedl344");
  </script>
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
             <div class="github-mark">
              <a href="https://github.com/pnp/script-samples" title="Go to repository">
               <div class="github-wrapper">
                  <div class="github-icon">
                    <img src="https://pnp.github.io/script-samples/assets/icons/github-light-64px.png" alt="GitHub Icon Image">
                  </div>
                  <div class="github-repository">
                    <span>GitHub</span>
                    <ul class="github-facts">
                      <li>
                        <i class="fa fa-code-fork" aria-hidden="true"></i>
                        <span class="github-forks"></span>
                      </li>
                      <li>
                        <i class="fa fa-star-o" aria-hidden="true"></i>
                        <span class="github-stars"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </a>
            </div>
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../assets/logo.svg" alt="">
              </a>    </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-12">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/script-samples/blob/main/scripts/spo-group-permission-report/README.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="get-permission-group-report-of-a-site">Get permission group report of a site</h1>

<h2 id="summary">Summary</h2>
<p>The scripts get group permission report of site and each list on the site and prints it to console and also sends it as an adaptive card to Teams channel specified by webhook.</p>
<p>result in console</p>
<p><img src="assets/console.png" alt="run in console"></p>
<p>result as adaptive card in teams</p>
<p><img src="assets/teams.png" alt="adaptive card in teams"></p>
<h2 id="implementation">Implementation</h2>
<ul>
<li>Open Windows PowerShell ISE</li>
<li>Create a new file</li>
<li>Copy a script  below</li>
</ul>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_cli-m365-ps" role="tab" aria-controls="tabpanel_CeZOj-G++Q_cli-m365-ps" data-tab="cli-m365-ps" tabindex="0" aria-selected="true">CLI for Microsoft 365</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q_cli-m365-ps" role="tabpanel" data-tab="cli-m365-ps">

<pre><code class="lang-powershell">$site = 'https://contoso.sharepoint.com/sites/someSite'
$adaptiveCard = '{\&quot;type\&quot;:\&quot;AdaptiveCard\&quot;,\&quot;body\&quot;:[{\&quot;type\&quot;:\&quot;TextBlock\&quot;,\&quot;size\&quot;:\&quot;Medium\&quot;,\&quot;weight\&quot;:\&quot;Bolder\&quot;,\&quot;text\&quot;:\&quot;${title}\&quot;},{\&quot;type\&quot;:\&quot;TextBlock\&quot;,\&quot;text\&quot;:\&quot;${description}\&quot;,\&quot;wrap\&quot;:true}],\&quot;$schema\&quot;:\&quot;http://adaptivecards.io/schemas/adaptive-card.json\&quot;,\&quot;version\&quot;:\&quot;1.3\&quot;}'
$webhook = ' https://contoso.webhook.office.com/webhookb2/1204eba2-061c-4442-9696-2a725cb2d094@2942bb31-1d49-4da6-8d3d-d0f9e1141486/IncomingWebhook/6e54c3958bde444e96fec9ecad356993/be11f523-2a4d-4eae-9d42-277410893c41'

try { 
    $m365Status = m365 status
    if ($m365Status -match &quot;Logged Out&quot;) {
        m365 login
    }
    
    Write-Host '----------------------------'
    Write-Host &quot;| Groups permission report |&quot;
    Write-Host '----------------------------'
    
    Write-Host &quot;Site: $site&quot;
    Write-Host '--------------------------------------------'

    $web = m365 spo web get --webUrl $site --withGroups
    $web = $web | ConvertFrom-Json
    
    $groups = m365 spo group list --webUrl $site
    $groups = $groups | ConvertFrom-Json

    $lists = m365 spo list list --webUrl $site
    $lists = $lists | ConvertFrom-Json
    
    $siteOwnerGroup = $web.AssociatedOwnerGroup
    $siteMemberGroup = $web.AssociatedMemberGroup
    $siteVisitorGroup = $web.AssociatedVisitorGroup

    $adaptiveCardDescription = &quot;Site [$($web.Title)]($site)&quot;

    Write-Host 'All groups on web'
    $adaptiveCardDescription += &quot;\n\n All groups on web&quot;
    foreach ($group in $groups) {
        Write-Host &quot;  &gt; $($group.Title)&quot;
        $adaptiveCardDescription += &quot;\n - $($group.Title)&quot;
    }
    
    Write-Host '--------------------------------------------'
    
    Write-Host 'Groups assiocieted with web'
    $adaptiveCardDescription += &quot;\n\n Groups assiocieted with web&quot;
    Write-Host &quot;  &gt; $($siteOwnerGroup.Title)&quot;
    $adaptiveCardDescription += &quot;\n - $($siteOwnerGroup.Title)&quot;
    Write-Host &quot;  &gt; $($siteMemberGroup.Title)&quot;
    $adaptiveCardDescription += &quot;\n - $($siteMemberGroup.Title)&quot;
    Write-Host &quot;  &gt; $($siteVisitorGroup.Title)&quot;
    $adaptiveCardDescription += &quot;\n - $($siteVisitorGroup.Title)&quot;
    Write-Host '--------------------------------------------'

    Write-Host 'Lists group permissions'
    $adaptiveCardDescription += &quot;\n\n Lists group permissions&quot;
    foreach ($list in $lists) {
        $listWithPermissions = m365 spo list get --title $list.Title --webUrl $site --withPermissions
        $listWithPermissions = $listWithPermissions | ConvertFrom-Json

        $hidden = ''
        if ($list.Hidden) {
            $hidden = '(Hidden List)'
        }

        if ($listWithPermissions.HasUniqueRoleAssignments) {
            Write-Host &quot;  &gt; $($list.Title) $hidden : Unique permissions&quot;
            $adaptiveCardDescription += &quot;\n - $($list.Title) $hidden : Unique permissions&quot;
            foreach ($roleAssignment in $listWithPermissions.roleAssignments) {
                Write-Host &quot;     &gt; $($roleAssignment.Member.Title) - $($roleAssignment.RoleDefinitionBindings.Name)&quot;
                $adaptiveCardDescription += &quot;\n      - $($roleAssignment.Member.Title) - $($roleAssignment.RoleDefinitionBindings.Name)&quot;
            }            
        }
        else {
            Write-Host &quot;  &gt; $($list.Title) : Inherits permissions from web&quot;
            $adaptiveCardDescription += &quot;\n - $($list.Title) : Inherits permissions from web&quot;
        }
    }
    Write-Host '--------------------------------------------'

    $today = Get-Date -Format &quot;MM/dd/yyyy&quot;
    $cardData = '{\&quot;title\&quot;: \&quot;Groups permission report - ' + $today + '\&quot; ,\&quot;description\&quot;:\&quot;' + $adaptiveCardDescription + '\&quot;}'
    m365 adaptivecard send --url $webhook --card $adaptiveCard --cardData $cardData
}
catch {
    Write-Host &quot;An error occurred:&quot;
    Write-Host $_
}
</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>CLI for Microsoft 365</strong> to learn more at: <a href="https://aka.ms/cli-m365">https://aka.ms/cli-m365</a></p>
</div>
<div class="highlight-tool-red">
<p>Important changes coming to the way you login into CLI for Microsoft 365 (effective 9th September 2024) see <a href="https://pnp.github.io/blog/post/changes-pnp-management-shell-registration/">Changes in PnP Management Shell registration in Microsoft 365</a></p>
</div>
</section>
</div>
<h2 id="contributors">Contributors</h2>
<table>
<thead>
<tr>
<th>Author(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/Adam-it">Adam Wójcik</a></td>
</tr>
</tbody>
</table>
<h2 id="disclaimer">Disclaimer</h2>
<p><strong>THESE SAMPLES ARE PROVIDED <em>AS IS</em> WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING ANY IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABILITY, OR NON-INFRINGEMENT.</strong></p>
<img src="https://m365-visitor-stats.azurewebsites.net/script-samples/scripts/spo-remove-large-library" aria-hidden="true">
</article>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Script Samples<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
            <!-- <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer"> -->
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    
    <script type="text/javascript" src="../styles/clipboard.min.js"></script>
    <script type="text/javascript" src="../styles/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="../styles/loadsamples.js"></script>
    <script type="text/javascript" src="../styles/filtersamples.js"></script>

  </body>
</html>