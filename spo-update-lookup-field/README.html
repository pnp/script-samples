<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>Updates a SharePoint Online lookup column to reference a lookup list | PnP Samples </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="title" content="Updates a SharePoint Online lookup column to reference a lookup list | PnP Samples ">
    <meta name="generator" content="docfx ">
  <meta name="description" content="A sample gallery of scripts to manage all things Microsoft 365.">

    <!-- Social Media -->
    <meta property="og:locale" content="en_GB">
    <meta property="og:title" content="Updates a SharePoint Online lookup column to reference a lookup list | PnP Samples ">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pnp.github.io/script-samples">
    <meta property="og:image" content="https://pnp.github.io/script-samples/assets/social-media-screenshot.png">
    <meta property="og:image:alt" content="Screenshot example of the PnP Script Samples Site">
    <meta property="og:site_name" content="PnP Script Samples">
    <meta name="msvalidate.01" content="04EFEDA66EC42C08A1247C979E2F9ADD">
  <meta property="og:description" content="A sample gallery of scripts to manage all things Microsoft 365.">

    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.min.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/extra.css">
    <link rel="stylesheet" href="../styles/filter.css">
    <link rel="stylesheet" href="../styles/site.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
  
  
  <meta property="docfx:newtab" content="true">
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "8j6pedl344");
  </script>
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
             <div class="github-mark">
              <a href="https://github.com/pnp/script-samples" title="Go to repository">
               <div class="github-wrapper">
                  <div class="github-icon">
                    <img src="https://pnp.github.io/script-samples/assets/icons/github-light-64px.png" alt="GitHub Icon Image">
                  </div>
                  <div class="github-repository">
                    <span>GitHub</span>
                    <ul class="github-facts">
                      <li>
                        <i class="fa fa-code-fork" aria-hidden="true"></i>
                        <span class="github-forks"></span>
                      </li>
                      <li>
                        <i class="fa fa-star-o" aria-hidden="true"></i>
                        <span class="github-stars"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </a>
            </div>
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../assets/logo.svg" alt="">
              </a>            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-12">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/script-samples/blob/main/scripts/spo-update-lookup-field/README.md/#L1" title="Edit this page" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
  <h1 id="updates-a-sharepoint-online-lookup-column-to-reference-a-lookup-list">Updates a SharePoint Online lookup column to reference a lookup list</h1>

<h2 id="summary">Summary</h2>
<p>This PowerShell script enhances SharePoint Online list management by updating a lookup column in a list to reference a lookup list. Using PnP PowerShell, it modifies the lookup columnâ€™s schema XML to set or update the List, WebId, ShowField. The script allows users to specify the primary display field (via ShowFieldName, e.g., Title, ID).</p>
<p><img src="assets/LookupField.png" alt="Example Screenshot"></p>
<div class="tabGroup" id="tabgroup_1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_1_pnpps" role="tab" aria-controls="tabpanel_1_pnpps" data-tab="pnpps" tabindex="0" aria-selected="true">PnP PowerShell</a>
</li>
</ul>
<section id="tabpanel_1_pnpps" role="tabpanel" data-tab="pnpps">

<pre><code class="lang-powershell">&lt;#
.SYNOPSIS
    Updates a SharePoint Online lookup column to reference a lookup list
.DESCRIPTION
    This script uses PnP PowerShell to update the schema XML of a lookup column in a source list to point to a recreated lookup list by setting or updating the List, WebId, ShowField. The ShowField attribute sets the primary display field.
.PARAMETER SiteUrl
    The URL of the SharePoint Online site (e.g., https://contoso.sharepoint.com/sites/yoursite).
.PARAMETER TargetListName
    The name of the list containing the lookup column.
.PARAMETER LookupListName
    The name of the lookup list.
.PARAMETER LookupColumnName
    The internal name of the lookup column in the list.
.PARAMETER ShowFieldName
    The internal name of the primary field in the lookup list to display (e.g., Title, ID). Defaults to Title.

.EXAMPLE
    .\Update-LookupColumn.ps1 -SiteUrl &quot;https://contoso.sharepoint.com/sites/yoursite&quot; -TargetListName &quot;targetList&quot; -LookupListName &quot;LookupList&quot; -LookupColumnName &quot;LookupColumn&quot; -ShowFieldName &quot;ID&quot;
    Updates the lookup column &quot;LookupColumn&quot; in &quot;targetList&quot; to reference &quot;LookupList&quot;
.NOTES
    - Ensure the PnP PowerShell module is installed: Install-Module -Name PnP.PowerShell.
    - The lookup list must have the fields specified in ShowFieldName.

.LINK
    https://pnp.github.io/script-samples
#&gt;

[CmdletBinding()]
param (
    [Parameter(Mandatory = $true, HelpMessage = &quot;The URL of the SharePoint Online site.&quot;)]
    [string]$SiteUrl,

    [Parameter(Mandatory = $true, HelpMessage = &quot;The name of the source list containing the lookup column.&quot;)]
    [string]$TargetListName,

    [Parameter(Mandatory = $true, HelpMessage = &quot;The name of the lookup list.&quot;)]
    [string]$LookupListName,

    [Parameter(Mandatory = $true, HelpMessage = &quot;The internal name of the lookup column in the source list.&quot;)]
    [string]$LookupColumnName,

    [Parameter(Mandatory = $false, HelpMessage = &quot;The internal name of the primary field in the lookup list to display (e.g., Title, ID).&quot;)]
    [string]$ShowFieldName = &quot;Title&quot;
)

try {
    # Connect to the SharePoint site
    $ClientId = &quot;&lt;your-client-id&gt;&quot; # Replace with your Microsoft Entra ID (Azure AD) app client ID
    $Tenant= &quot;&lt;your-tenant-name&gt;&quot; #contoso.sharepoint.com

    Write-Host &quot;Connecting to SharePoint site: $SiteUrl&quot; -ForegroundColor Cyan
    Connect-PnPOnline -Url $SiteUrl -ClientId $ClientId -Tenant $Tenant  -Interactive -ErrorAction Stop
    Write-Host &quot;Connected successfully.&quot; -ForegroundColor Green
    # Get the recreated lookup list
    $lookupList = Get-PnPList -Identity $LookupListName -ErrorAction Stop
    if ($null -eq $lookupList) {
        throw &quot;Lookup list '$LookupListName' not found.&quot;
    }

    # Get the source list
    $targetList = Get-PnPList -Identity $TargetListName -Includes Fields -ErrorAction Stop
    if ($null -eq $targetList) {
        throw &quot;Source list '$TargetListName' not found.&quot;
    }

    # Get the lookup field
    $lookupField = Get-PnPField -List $targetList.Title -Identity $LookupColumnName -ErrorAction Stop
    if ($null -eq $lookupField) {
        throw &quot;Lookup column '$LookupColumnName' not found in list '$TargetListName'.&quot;
    }

    # Validate ShowFieldName
    $showField = Get-PnPField -List $lookupList.Title -Identity $ShowFieldName -ErrorAction Stop
    if ($null -eq $showField) {
        throw &quot;Field '$ShowFieldName' not found in lookup list '$LookupListName'.&quot;
    }

    # Get the lookup list's GUID and web ID
    $lookupListId = $lookupList.Id
    $web = Get-PnPWeb -ErrorAction Stop
    $webId = $web.Id

    # Get the current schema XML
    $schemaXml = $lookupField.SchemaXml

    # Update or add List attribute
    $listPattern = 'List=&quot;{[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}}&quot;'
    if ($schemaXml -match $listPattern) {
        $schemaXml = $schemaXml -replace $listPattern, &quot;List=`&quot;$lookupListId`&quot;&quot;
        Write-Host &quot;Updated existing List attribute with new GUID: $lookupListId&quot; -ForegroundColor Green
    }
    elseif ($schemaXml -match 'List=&quot;[^&quot;]*&quot;') {
        $schemaXml = $schemaXml -replace 'List=&quot;[^&quot;]*&quot;', &quot;List=`&quot;$lookupListId`&quot;&quot;
        Write-Host &quot;Replaced invalid List attribute with new GUID: $lookupListId&quot; -ForegroundColor Green
    }
    else {
        $schemaXml = $schemaXml -replace '/&gt;', &quot; List=`&quot;$lookupListId`&quot;/&gt;&quot;
        Write-Host &quot;Added missing List attribute with GUID: $lookupListId&quot; -ForegroundColor Green
    }

    # Update or add WebId attribute
    $webIdPattern = 'WebId=&quot;{[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}}&quot;'
    if ($schemaXml -match $webIdPattern) {
        $schemaXml = $schemaXml -replace $webIdPattern, &quot;WebId=`&quot;$webId`&quot;&quot;
        Write-Host &quot;Updated existing WebId attribute with new GUID: $webId&quot; -ForegroundColor Green
    }
    elseif ($schemaXml -match 'WebId=&quot;[^&quot;]*&quot;') {
        $schemaXml = $schemaXml -replace 'WebId=&quot;[^&quot;]*&quot;', &quot;WebId=`&quot;$webId`&quot;&quot;
        Write-Host &quot;Replaced invalid WebId attribute with new GUID: $webId&quot; -ForegroundColor Green
    }
    else {
        $schemaXml = $schemaXml -replace '/&gt;', &quot; WebId=`&quot;$webId`&quot;/&gt;&quot;
        Write-Host &quot;Added missing WebId attribute with GUID: $webId&quot; -ForegroundColor Green
    }

    # Update or add ShowField attribute
    $showFieldPattern = 'ShowField=&quot;[^&quot;]*&quot;'
    if ($schemaXml -match $showFieldPattern) {
        $schemaXml = $schemaXml -replace $showFieldPattern, &quot;ShowField=`&quot;$ShowFieldName`&quot;&quot;
        Write-Host &quot;Updated ShowField attribute to: $ShowFieldName&quot; -ForegroundColor Green
    }
    else {
        $schemaXml = $schemaXml -replace '/&gt;', &quot; ShowField=`&quot;$ShowFieldName`&quot;/&gt;&quot;
        Write-Host &quot;Added missing ShowField attribute: $ShowFieldName&quot; -ForegroundColor Green
    }


    # Apply the updated schema
    Set-PnPField -List $targetList -Identity $LookupColumnName -Values @{SchemaXml = $schemaXml } -ErrorAction Stop
    Write-Host &quot;Updated lookup column schema for '$LookupColumnName'.&quot; -ForegroundColor Green

}
catch {
    Write-Host &quot;Error: $($_.Exception.Message)&quot; -ForegroundColor Red
    Write-Host &quot;Stack Trace: $($_.ScriptStackTrace)&quot; -ForegroundColor Red
}
finally {
    # Disconnect from the site
    Disconnect-PnPOnline -ErrorAction SilentlyContinue
    Write-Host &quot;Disconnected from SharePoint site.&quot; -ForegroundColor Cyan
}
</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>PnP PowerShell</strong> to learn more at: <a href="https://aka.ms/pnp/powershell">https://aka.ms/pnp/powershell</a></p>
</div>
<div class="highlight-tool">
<p>The way you login into PnP PowerShell has changed please read <a href="https://github.com/pnp/powershell/discussions/4249">PnP Management Shell EntraID app is deleted : what should I do ?</a></p>
</div>
</section>
</div>
<h2 id="contributors">Contributors</h2>
<table>
<thead>
<tr>
<th>Author(s)</th>
</tr>
</thead>
</table>
<p>| <a href="https://github.com/harmindersethi">Harminder Singh</a> |</p>
<h2 id="disclaimer">Disclaimer</h2>
<p><strong>THESE SAMPLES ARE PROVIDED <em>AS IS</em> WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING ANY IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABILITY, OR NON-INFRINGEMENT.</strong></p>
<img src="https://m365-visitor-stats.azurewebsites.net/script-samples/scripts/spo-update-lookup-filed" aria-hidden="true">

</article>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      <span>Script Samples<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
      
            <!-- <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer"> -->
          </div>
        </div>
      </footer>    </div>

    <script type="text/javascript" src="../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>

    <script type="text/javascript" src="../styles/clipboard.min.js"></script>
    <script type="text/javascript" src="../styles/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="../styles/loadsamples.js"></script>
    <script type="text/javascript" src="../styles/filtersamples.js"></script>

  </body>
</html>