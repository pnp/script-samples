<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <title>Export a csv report on all Microsoft Stream videos | PnP Samples </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Export a csv report on all Microsoft Stream videos | PnP Samples ">
    <meta name="generator" content="docfx 2.56.7.0">
    <meta name="description" content="A sample gallery of scripts to manage all things Microsoft 365.">
  
    <!-- Social Media -->
    <meta property="og:locale" content="en_GB">
    <meta property="og:title" content="Export a csv report on all Microsoft Stream videos | PnP Samples ">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pnp.github.io/script-samples">
    <meta property="og:image" content="https://pnp.github.io/script-samples/assets/social-media-screenshot.png">
    <meta property="og:image:alt" content="Screenshot example of the PnP Script Samples Site">
    <meta property="og:site_name" content="PnP Script Samples">
    <meta property="og:description" content="A sample gallery of scripts to manage all things Microsoft 365.">
  
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/extra.css">
    <link rel="stylesheet" href="../styles/filter.css">
    <link rel="stylesheet" href="../styles/site.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    <meta property="docfx:newtab" content="true">
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "8j6pedl344");
  </script>
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
             <div class="github-mark">
              <a href="https://github.com/pnp/script-samples" title="Go to repository">
               <div class="github-wrapper">
                  <div class="github-icon">
                    <img src="https://pnp.github.io/script-samples/assets/icons/github-light-64px.png" alt="GitHub Icon Image">
                  </div>
                  <div class="github-repository">
                    <span>GitHub</span>
                    <ul class="github-facts">
                      <li>
                        <i class="fa fa-code-fork" aria-hidden="true"></i>
                        <span class="github-forks"></span>
                      </li>
                      <li>
                        <i class="fa fa-star-o" aria-hidden="true"></i>
                        <span class="github-stars"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </a>
            </div>
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../assets/logo.svg" alt="">
              </a>    </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-12">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/script-samples/blob/main/scripts/stream-report-videos/README.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="export-a-csv-report-on-all-microsoft-stream-videos">Export a csv report on all Microsoft Stream videos</h1>

<p><img src="assets/header.png" alt="Outputs"></p>
<h2 id="summary">Summary</h2>
<p>Export a report on all Microsoft Stream (Classic) videos (build on SharePoint)</p>
<p>Microsoft Stream (Classic) will be retired soon , therefore we need to gather a list of all videos info for a mid-term migration<br>
This script allow us to export a list with all videos detailed in our tenant .</p>
<p>The script is a subset of the SPO PowerShell packages with content (PnPCandy) concept already been used across many projects.</p>
<p>Excelsior, hum? :P</p>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_pnpps" role="tab" aria-controls="tabpanel_CeZOj-G++Q_pnpps" data-tab="pnpps" tabindex="0" aria-selected="true">PnP PowerShell</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_pnpps2" role="tab" aria-controls="tabpanel_CeZOj-G++Q_pnpps2" data-tab="pnpps2" tabindex="-1">PnP PowerShell Alternative</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q_pnpps" role="tabpanel" data-tab="pnpps"><button class="article-clipboard" title="Copy to clipboard" data-toggle="tooltip" data-placement="top" data-clipboard-target="section[id^='tabpanel'][data-tab='pnpps'] pre">
    <span class="glyphicon glyphicon-copy" aria-hidden="true"></span>
    <span class="article-clipboard__message done">Copied</span>
</button>

<pre><code class="lang-powershell">

[CmdletBinding()]
param (
    [Parameter(Mandatory = $False)]
    [string]$ExportPath = &quot;.\&quot;
)
begin {
    $ErrorActionPreference = &quot;Stop&quot;
    $source = @&quot;
[DllImport(&quot;wininet.dll&quot;, SetLastError = true)]
public static extern bool InternetSetOption(IntPtr hInternet, int dwOption, IntPtr lpBuffer, int lpdwBufferLength);

[DllImport(&quot;wininet.dll&quot;, SetLastError = true)]
public static extern bool InternetGetCookieEx(string pchURL, string pchCookieName, System.Text.StringBuilder pchCookieData, ref uint pcchCookieData, int dwFlags, IntPtr lpReserved);
&quot;@
## Clear WebBrowser cookies 
function Clear-WebBrowser {
        begin {
            $WebBrowser = Add-Type -memberDefinition $source -passthru -name WebBrowser -ErrorAction SilentlyContinue
            $INTERNET_OPTION_END_BROWSER_SESSION = 42
            $INTERNET_OPTION_SUPPRESS_BEHAVIOR = 81
            $INTERNET_COOKIE_HTTPONLY = 0x00002000
            $INTERNET_SUPPRESS_COOKIE_PERSIST = 3
        }
        Process {
            
            # Clear the cache
            [IntPtr] $pointer = [IntPtr]::Zero
            $session = [System.Runtime.InteropServices.Marshal]::SizeOf($INTERNET_OPTION_END_BROWSER_SESSION)
            $pointer = [System.Runtime.InteropServices.Marshal]::AllocCoTaskMem($session)
            [System.Runtime.InteropServices.Marshal]::WriteInt32($pointer, ([ref]$INTERNET_SUPPRESS_COOKIE_PERSIST).Value)
            $status = $WebBrowser::InternetSetOption([IntPtr]::Zero, $INTERNET_OPTION_SUPPRESS_BEHAVIOR, $pointer, $session)
            [System.Runtime.InteropServices.Marshal]::Release($pointer) | out-null
    
            # Clear the current session
            $status = $WebBrowser::InternetSetOption([IntPtr]::Zero, $INTERNET_OPTION_END_BROWSER_SESSION, [IntPtr]::Zero, 0)
        }
    }

    ## From built for MsStream authentication
    function Show-OAuthWindowStream {
        param (
            [string]$url,
            [string]$WindowTitle,
            ## Default value : resource for teams
            [string]$Resource,
            ## Default value : edirect for native teams app
            [string]$Auth_Redirect,
            [string]$ClientId,
            [string]$Tenant,
            [bool]$ForceMFA = $false
        )
        if ([String]::IsNullOrEmpty($Tenant)) {
            $Tenant = &quot;common&quot;
        }
        # Create the url
        $request_id = (New-Guid).ToString()
        
        if ($ForceMFA) {
            $url += &quot;&amp;amr_values=mfa&quot;
        }
        
        Add-Type -AssemblyName System.Windows.Forms
        $form = New-Object -TypeName System.Windows.Forms.Form -Property @{Width = 600; Height = 800 }
        $form.Text = $WindowTitle

        $script:web = New-Object -TypeName System.Windows.Forms.WebBrowser -Property @{Width = 580; Height = 780; Url = ($URL -f ($Scope -join &quot;%20&quot;)) }
        $web.ScriptErrorsSuppressed = $True
        $form.Controls.Add($web)
        $featured = {
            $head = $web.Document.GetElementsByTagName(&quot;head&quot;)[0];
            $scriptEl = $web.Document.CreateElement(&quot;script&quot;);
            $element = $scriptEl.DomElement;
            ## Capture MsStream tenant info and tokens! :P
            $element.text = &quot;
          
            function CaptureToken() { 
                var tenantInfo = new Object();
                tenantInfo.AccessToken =''
                if (sessionInfo != undefined) {
                    tenantInfo = new Object();
                    token=sessionInfo.AccessToken;
                    tenantInfo.AccessToken = sessionInfo.AccessToken;
                    tenantInfo.TenantId = sessionInfo.UserClaim.TenantId;
                    tenantInfo.ApiGatewayUri  =sessionInfo.ApiGatewayUri;
                    tenantInfo.ApiGatewayVersion=sessionInfo.ApiGatewayVersion;
                    return (JSON.stringify(tenantInfo));
                  }
                return (JSON.stringify(tenantInfo));
            }
            &quot;;
            $head.AppendChild($scriptEl);
            $tenantInfoString = $web.Document.InvokeScript(&quot;CaptureToken&quot;);
          
            $tenantInfo = ConvertFrom-Json $tenantInfoString
            if ($tenantInfo.AccessToken.length -ne 0 ) {
                $script:tenantInfo = $tenantInfo;
                $url = &quot;https://login.windows.net/common/oauth2/logout&quot;
                $form.Controls[0].Url = $url
                $form.Controls[0].Dispose()
                $form.Close()
                $form.Dispose()
                Clear-WebBrowser 
            }

        }
        $web.add_Navigated($featured)
        $form.Add_Shown( { $form.Activate() })
        $form.ShowDialog() | Out-Null
      
    }
    #Logging function
    function Write-Log($msg) {
        $message = &quot;$($env:MainFunctionName)$($env:FunctionName) $msg&quot;
        $message = $message.Trim()
        Write-Host $message
    }
    
    #Export Reports to a csv filename
    function Export-ReportAssets([psCustomObject]$assets, [string] $label, [string]$fileName,[bool] $showLastMessage) {
        if ($null -ne $assets) {
            Write-Log &quot; Exporting [$($assets.Length)] $label(s) ...&quot;
            $ExportPath = Resolve-Path $ExportPath
            $assets |  Export-Csv -Path &quot;$ExportPath\$fileName.csv&quot; -Force -NoTypeInformation
            if ($showLastMessage -eq $true)
            {
                Write-Log  &quot; All info exported at [$ExportPath] &quot;
            }
        }
        else {
            Write-Log &quot; No $label(s) were found&quot;
        }
      
    }
    #Camel Case Props Names to ease up report reading
    function Set-AttributesCammelCase([psCustomObject]$allItems, [string]$prefix) {
        #CammelCase all Properties
        $items = @();
        $allItems | ForEach-Object {
            $t = $_
            $newObj = [PSCustomObject]::new()
            if ($null -ne $t) {
                $t | Get-Member -MemberType Properties | ForEach-Object {
               
                    $obj = $_
                    if ($obj.Name -eq &quot;posterImage&quot;)
                    {
                        $A=&quot;&quot;
                    }
                    $name = ($_.Name.substring(0, 1).toupper() + $_.Name.substring(1, $_.Name.length - 1))
                    if ($_.Definition -match &quot;Object&quot;) {
                        $n = $_.Name
                        $element = @(($t.&quot;$name&quot;)) 

                        $a = $t.$name
                        $name = ($n.substring(0, 1).toupper() + $n.substring(1, $n.length - 1))
                        $atts = Set-AttributesCammelCase -allItems $element -prefix $name
                        
                        if ($null -ne $atts) {
                            # $newObj = [PSCustomObject]::new()
                            if ($atts.Count -gt 1) {
                                $ct = 0
                                $atts |  ForEach-Object {
                                    $item = $_
                                    
                                    $item | Get-Member -MemberType Properties | ForEach-Object {
                                        $prop = $_
                                       
                                       
                                            $nname = $prop.Name
                                        
                                       
                                        $nvalue = $item.&quot;$nname&quot;
                                        $newObj | Add-Member -Name  (&quot;$ct$nname&quot;) -MemberType NoteProperty -Value  $nvalue
                                    }
                                    $ct++
                                }
                            }
                            else {
                                $atts | Get-Member -MemberType Properties | ForEach-Object {
                                    $prop = $_
                                    if ($prefix.Length -gt 0) {
                                        $pp= $prop.Name
                                        $nname = &quot;$prefix.$pp&quot; 
                                        $nvalue = $atts.&quot;$pp&quot;
                                        }
                                    else{
                                        $nname = $prop.Name
                                        $nvalue = $atts.&quot;$nname&quot;
                                    }
                                    $newObj | Add-Member -Name  $nname -MemberType NoteProperty -Value  $nvalue
                                }
                            }
                        }
                    }
               
                    else {
                        $newName = &quot;$name&quot;
                        if ($prefix.Length -gt 0) {
                            $newName = &quot;$prefix.$name&quot;
                        }
                        $newValue = $t.&quot;$name&quot;
                        $newObj | Add-Member -Name $newName  -MemberType NoteProperty -Value  $newValue
                    }
                
               
                }
                $items += $newObj
            }
            
        }
        $items
    }
    #Fetch requested assets with paging (msstream only allows 100 items per page )
    function Get-RequestedAssets([PSCustomObject]$token, [string]$url, [int]$startIndex, [string]$label) {
        Write-Log &quot; Fetching [$label] Assets Start&quot;
        $index = $startIndex
        $mainUrl = $url
        $allItems = @()
        do {
            $restUrl = $mainUrl.Replace(&quot;`$skip=0&quot;, &quot;`$skip=$index&quot;) 
            
            $items = @((Invoke-RestMethod -Uri $restUrl -Headers $token.headers -Method Get).value)
            if ($items.Count -ne 0) {
                $id = &quot;[{0}]&quot; -f $items[0].id
                $name = &quot;[{0}]&quot; -f $items[0].Name
                $txtIndex = (&quot;[FirstElementOnTheBatch][{0}]&quot; -f $index) + $id + $name
                Write-Log &quot;  Fetching ... [Paging $txtIndex]&quot;

                $items | Add-Member  -Name &quot;Type&quot; -MemberType NoteProperty -Value  $Label
                $items | Add-Member  -Name &quot;ViewVideoUrl&quot; -MemberType NoteProperty -Value  (&quot;https://web.microsoftstream.com/video/&quot; + $items.Id)
              
                $items = Set-AttributesCammelCase -allItems  $items
            }
            $allItems += $items
            $index += 100
            
        } until ($items.Count -eq 0)
        Write-Log (&quot;  Found [&quot; + $allItems.Count + &quot;] items!&quot;)
        $assets = $allItems | SeLect-Object `
                                Type,Id, Name,@{Name='Size(MB)';Expression={$_.AssetSize/1MB}}, `
                                PrivacyMode, State,VideoMigrationStatus, Published,PublishedDate, 	
                            	ContentType,Created,Modified, `
                                Media.Duration,	Media.Height,Media.Width,`
                                Metrics.Comments,Metrics.Likes,Metrics.Views, `
                                ViewVideoUrl
        Write-Log &quot; Fetching [$label] Assets End&quot;
        
        $assets
    }
    #Main function to collect token and tenant configuration  
    function Get-StreamToken() {
       
        Show-OAuthWindowStream -url &quot;https://web.microsoftstream.com/?noSignUpCheck=1&quot; -WindowTitle  &quot;Please login to Microsoft Stream ...&quot;
        $token = $script:tenantInfo.AccessToken
        $headers = @{
            &quot;Authorization&quot;   = (&quot;Bearer &quot; + $token)
            &quot;accept-encoding&quot; = &quot;gzip, deflate, br&quot;
        }
        $urlTenant = $script:tenantInfo.ApiGatewayUri
        $apiVersion = $script:tenantInfo.ApiGatewayVersion
        
        $urlBase = &quot;$urlTenant{0}?`$skip=0&amp;`$top=100&amp;adminmode=true&amp;api-version=$apiVersion&quot; 
        
        $requestToken = [PSCustomObject]::new()
        $requestToken | Add-Member  -Name &quot;token&quot; -MemberType NoteProperty -Value  $token
        $requestToken | Add-Member  -Name &quot;headers&quot; -MemberType NoteProperty -Value  $headers
        $requestToken | Add-Member  -Name &quot;tenantInfo&quot; -MemberType NoteProperty -Value $script:tenantInfo
        
        $urls = [PSCustomObject]::new()
        $requestToken | Add-Member  -Name &quot;urls&quot; -MemberType NoteProperty -Value  $urls

        $requestToken.urls | Add-Member  -Name &quot;Videos&quot; -MemberType NoteProperty -Value  ($urlBase -f &quot;videos&quot;)
        $requestToken.urls | Add-Member  -Name &quot;Channels&quot; -MemberType NoteProperty -Value   ($urlBase -f &quot;channels&quot;)
        $requestToken.urls | Add-Member  -Name &quot;Groups&quot; -MemberType NoteProperty -Value  ($urlBase -f &quot;groups&quot;)
        
        $urlBase = $urlBase.replace(&quot;`$skip=0&amp;&quot;, &quot;&quot;)
        $requestToken.urls | Add-Member  -Name &quot;Principals&quot; -MemberType NoteProperty -Value   ($urlBase -f &quot;principals&quot;)

        $requestToken
    }
  
    $env:functionName = &quot;&quot;
    $env:MainFunctionName = &quot;&quot;


    $msg = &quot;`n`r`n`r

    █▀█ █▄░█ █▀█ █▀▀ ▄▀█ █▄░█ █▀▄ █▄█
    █▀▀ █░▀█ █▀▀ █▄▄ █▀█ █░▀█ █▄▀ ░█░  `n    MSStreamToolSet: `n`r    Report all MSStream Videos    `n`n    Export a report on all Microsoft Stream videos (complete list and all videos not yet migrated) `n`n    ...aka ... [stream-report-videos]
    `n&quot;
    $msg += ('#' * 70) + &quot;`n&quot;
    Write-Output  $msg
    $env:functionName = &quot;[Report-Stream-Videos]&quot;

}
process {
   
    $streamTokenConfiguration = Get-StreamToken -Tenant $Tenant -Credentials $creds
    $allVideos = Get-RequestedAssets -token $streamTokenConfiguration -url $streamTokenConfiguration.urls.Videos -startIndex 0 -label &quot;Videos&quot;
    Export-ReportAssets -assets $allVideos -label &quot;Videos&quot;-fileName &quot;StreamVideosAll&quot; 
    $videosNotMigrated = $allVideos | Where-Object {$_.VideoMigrationStatus -eq &quot;NotStarted&quot;}
    Export-ReportAssets -assets $videosNotMigrated -label &quot;VideosNotMigrated&quot;-fileName &quot;StreamVideosNotMigrated&quot; -showLastMessage $true
    
}
end {
    Write-Log &quot;All done&quot;
}


</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>PnP PowerShell</strong> to learn more at: <a href="https://aka.ms/pnp/powershell">https://aka.ms/pnp/powershell</a></p>
</div>
</section>
<section id="tabpanel_CeZOj-G++Q_pnpps2" role="tabpanel" data-tab="pnpps2" aria-hidden="true" hidden="hidden"><button class="article-clipboard" title="Copy to clipboard" data-toggle="tooltip" data-placement="top" data-clipboard-target="section[id^='tabpanel'][data-tab='pnpps2'] pre">
    <span class="glyphicon glyphicon-copy" aria-hidden="true"></span>
    <span class="article-clipboard__message done">Copied</span>
</button>

<pre><code class="lang-powershell">
[CmdletBinding()]
param (
    [parameter(Position=0,Mandatory=$False)] 
    [string]$OutputCsvFileName,

    [parameter(Position=1,Mandatory=$False)] 
    [switch]$OpenFileWhenComplete = $False
)


# ----------------------------------------------------------------------------------------------
function Show-OAuthWindowStream {
    param (
        [string]$Url,
        [string]$WindowTitle
    )
       
    $Source = `
@&quot;
    [DllImport(&quot;wininet.dll&quot;, SetLastError = true)]
    public static extern bool InternetSetOption(IntPtr hInternet, int dwOption, IntPtr lpBuffer, int lpdwBufferLength);
&quot;@

    $WebBrowser = Add-Type -memberDefinition $Source -passthru -name $('WebBrowser'+[guid]::newGuid().ToString('n'))
    $INTERNET_OPTION_END_BROWSER_SESSION = 42
    # Clear the current session
    $WebBrowser::InternetSetOption([IntPtr]::Zero, $INTERNET_OPTION_END_BROWSER_SESSION, [IntPtr]::Zero, 0) | out-null

    Add-Type -AssemblyName System.Windows.Forms
    $Form = New-Object -TypeName System.Windows.Forms.Form -Property @{Width = 600; Height = 800 }

    $Script:web = New-Object -TypeName System.Windows.Forms.WebBrowser -Property @{Width = 580; Height = 780; Url = ($URL -f ($Scope -join &quot;%20&quot;)) }
    $Web.ScriptErrorsSuppressed = $True
    $Form.Controls.Add($Web)
    $Featured = {
        $Head = $Web.Document.GetElementsByTagName(&quot;head&quot;)[0];
        $ScriptEl = $Web.Document.CreateElement(&quot;script&quot;);
        $Element = $ScriptEl.DomElement;

        # Javascript function to get the sessionInfo including the Token
        $Element.text = `
@'
        function CaptureToken() { 
            if( typeof sessionInfo === undefined ) {
                return '';
            } else {
                outputString = '{';
                outputString += '&quot;AccessToken&quot;:&quot;' + sessionInfo.AccessToken + '&quot;,';
                outputString += '&quot;TenantId&quot;:&quot;' + sessionInfo.UserClaim.TenantId + '&quot;,';
                outputString += '&quot;ApiGatewayUri&quot;:&quot;' + sessionInfo.ApiGatewayUri + '&quot;,';
                outputString += '&quot;ApiGatewayVersion&quot;:&quot;' + sessionInfo.ApiGatewayVersion + '&quot;';
                outputString += '}';

                return outputString;
            }
        }
'@;

        $Head.AppendChild($ScriptEl);
        $TenantInfoString = $Web.Document.InvokeScript(&quot;CaptureToken&quot;);
            
        if( [string]::IsNullOrEmpty( $TenantInfoString ) -eq $False ) {
            $TenantInfo = ConvertFrom-Json $TenantInfoString
            if ($TenantInfo.AccessToken.length -ne 0 ) {
                $Script:tenantInfo = $TenantInfo;
                $Form.Controls[0].Dispose()
                $Form.Close()
                $Form.Dispose()
            }
        }

    }
    $Web.add_DocumentCompleted($Featured)
    $Form.AutoScaleMode = 'Dpi'
    $Form.ShowIcon = $False
    $Form.Text = $WindowTitle
    $Form.AutoSizeMode = 'GrowAndShrink'
    $Form.StartPosition = 'CenterScreen'
    $Form.Add_Shown( { $Form.Activate() })
    $Form.ShowDialog() | Out-Null

    write-output $Script:tenantInfo
}

# ----------------------------------------------------------------------------------------------
function Get-RequestedAssets([PSCustomObject]$Token, [string]$Url, [string]$Label) {
    $Index = 0
    $MainUrl = $Url
    $AllItems = @()
    do {
        $RestUrl = $MainUrl.Replace(&quot;`$skip=0&quot;, &quot;`$skip=$Index&quot;) 
            
        Write-Host &quot;  Fetching ... $($Index) to $($Index+100)&quot;
        $Items = @((Invoke-RestMethod -Uri $RestUrl -Headers $Token.headers -Method Get).value)

        $AllItems += $Items
        $Index += 100
            
    } until ($Items.Count -lt 100)

    Write-Host &quot;  Fetched $($AllItems.count) items&quot;

    $Assets = $AllItems | Select-Object `
                            @{Name='Type';Expression={$Label}},`
                            Id, Name,`
                            @{Name='Size(MB)';Expression={$_.AssetSize/1MB}}, `
                            PrivacyMode, State, VideoMigrationStatus, Published, PublishedDate, ContentType, Created, Modified, `
                            @{name='Media.Duration';Expression={$_.Media.Duration}},`
                            @{name='Media.Height';Expression={$_.Media.Height}},`
                            @{name='Media.Width';Expression={$_.Media.Width}},`
                            @{name='Metrics.Comments';Expression={$_.Metrics.Comments}},`
                            @{name='Metrics.Likes';Expression={$_.Metrics.Likes}},`
                            @{name='Metrics.Views';Expression={$_.Metrics.Views}}, `
                            @{name='ViewVideoUrl';Expression={(&quot;https://web.microsoftstream.com/video/&quot; + $_.Id)}}
        
    write-output $Assets
}

# ----------------------------------------------------------------------------------------------
function Get-StreamToken() {
        
    $TenantInfo = Show-OAuthWindowStream -url &quot;https://web.microsoftstream.com/?noSignUpCheck=1&quot; -WindowTitle  &quot;Please login to Microsoft Stream ...&quot;
    $Token = $TenantInfo.AccessToken
    $Headers = @{
        &quot;Authorization&quot;   = (&quot;Bearer &quot; + $Token)
        &quot;accept-encoding&quot; = &quot;gzip, deflate, br&quot;
    }
    $UrlTenant = $TenantInfo.ApiGatewayUri
    $ApiVersion = $TenantInfo.ApiGatewayVersion
        
    $UrlBase = &quot;$UrlTenant{0}?`$skip=0&amp;`$top=100&amp;adminmode=true&amp;api-version=$ApiVersion&quot; 
        
    $RequestToken = [PSCustomObject]::new()
    $RequestToken | Add-Member  -Name &quot;token&quot; -MemberType NoteProperty -Value  $Token
    $RequestToken | Add-Member  -Name &quot;headers&quot; -MemberType NoteProperty -Value  $Headers
    $RequestToken | Add-Member  -Name &quot;tenantInfo&quot; -MemberType NoteProperty -Value $TenantInfo
        
    $Urls = [PSCustomObject]::new()
    $RequestToken | Add-Member  -Name &quot;urls&quot; -MemberType NoteProperty -Value  $Urls

    $RequestToken.urls | Add-Member  -Name &quot;Videos&quot; -MemberType NoteProperty -Value  ($UrlBase -f &quot;videos&quot;)
    $RequestToken.urls | Add-Member  -Name &quot;Channels&quot; -MemberType NoteProperty -Value   ($UrlBase -f &quot;channels&quot;)
    $RequestToken.urls | Add-Member  -Name &quot;Groups&quot; -MemberType NoteProperty -Value  ($UrlBase -f &quot;groups&quot;)
        
    $UrlBase = $UrlBase.replace(&quot;`$skip=0&amp;&quot;, &quot;&quot;)
    $RequestToken.urls | Add-Member  -Name &quot;Principals&quot; -MemberType NoteProperty -Value   ($UrlBase -f &quot;principals&quot;)

    write-output $RequestToken
}

$StreamToken = Get-StreamToken
$ExtractData = Get-RequestedAssets -token $StreamToken -Url $StreamToken.Urls.Videos -Label &quot;Videos&quot;

if( $OutputCsvFileName ) {
    $ExtractData | Export-CSV $OutputCsvFileName -NoTypeInformation -Encoding UTF8
    if( $OpenFileWhenComplete ) {
        Invoke-Item $OutputCsvFileName
    }
} else {
    write-output $ExtractData
}

</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>PnP PowerShell</strong> to learn more at: <a href="https://aka.ms/pnp/powershell">https://aka.ms/pnp/powershell</a></p>
</div>
</section>
</div>
<h2 id="contributors">Contributors</h2>
<table>
<thead>
<tr>
<th>Author(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Rodrigo Pinto</td>
</tr>
<tr>
<td>Twan van Beers</td>
</tr>
</tbody>
</table>
<h2 id="disclaimer">Disclaimer</h2>
<p><strong>THESE SAMPLES ARE PROVIDED <em>AS IS</em> WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING ANY IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABILITY, OR NON-INFRINGEMENT.</strong></p>
<img src="https://pnptelemetry.azurewebsites.net/script-samples/scripts/stream-report-videos" aria-hidden="true">
</article>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Script Samples<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
            <!-- <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer"> -->
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    
    <script type="text/javascript" src="../styles/clipboard.min.js"></script>
    <script type="text/javascript" src="../styles/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="../styles/loadsamples.js"></script>
    <script type="text/javascript" src="../styles/filtersamples.js"></script>

  </body>
</html>