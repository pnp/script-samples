<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>List of active sites in Tenant with Admins and storage used | PnP Samples </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="title" content="List of active sites in Tenant with Admins and storage used | PnP Samples ">
    <meta name="generator" content="docfx ">
  <meta name="description" content="A sample gallery of scripts to manage all things Microsoft 365.">

    <!-- Social Media -->
    <meta property="og:locale" content="en_GB">
    <meta property="og:title" content="List of active sites in Tenant with Admins and storage used | PnP Samples ">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pnp.github.io/script-samples">
    <meta property="og:image" content="https://pnp.github.io/script-samples/assets/social-media-screenshot.png">
    <meta property="og:image:alt" content="Screenshot example of the PnP Script Samples Site">
    <meta property="og:site_name" content="PnP Script Samples">
    <meta name="msvalidate.01" content="04EFEDA66EC42C08A1247C979E2F9ADD">
  <meta property="og:description" content="A sample gallery of scripts to manage all things Microsoft 365.">

    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.min.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/extra.css">
    <link rel="stylesheet" href="../styles/filter.css">
    <link rel="stylesheet" href="../styles/site.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
  
  
  <meta property="docfx:newtab" content="true">
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "8j6pedl344");
  </script>
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
             <div class="github-mark">
              <a href="https://github.com/pnp/script-samples" title="Go to repository">
               <div class="github-wrapper">
                  <div class="github-icon">
                    <img src="https://pnp.github.io/script-samples/assets/icons/github-light-64px.png" alt="GitHub Icon Image">
                  </div>
                  <div class="github-repository">
                    <span>GitHub</span>
                    <ul class="github-facts">
                      <li>
                        <i class="fa fa-code-fork" aria-hidden="true"></i>
                        <span class="github-forks"></span>
                      </li>
                      <li>
                        <i class="fa fa-star-o" aria-hidden="true"></i>
                        <span class="github-stars"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </a>
            </div>
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../assets/logo.svg" alt="">
              </a>            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-12">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/script-samples/blob/main/scripts/spo-tenant-site-inventory/README.md/#L1" title="Edit this page" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
  <h1 id="list-of-active-sites-in-tenant-with-admins-and-storage-used">List of active sites in Tenant with Admins and storage used</h1>

<h2 id="summary">Summary</h2>
<p>This script provides you the list of active sites in your tenant with their administrator and usage in MB.</p>
<h2 id="why-it-matters--real-world-scenario">Why It Matters / Real-World Scenario</h2>
<p>In many Microsoft 365 tenants, SharePoint sites can quickly grow in number, with varying levels of administrative access and external sharing. Without visibility, itâ€™s easy for unused or inactive sites to remain accessible, or for administrators to have unnecessary access to sensitive content.</p>
<p>For example, an organization may have hundreds of departmental and project sites, some of which have never been used or have files shared externally. Security and compliance teams need to know:</p>
<ul>
<li>Which sites have active administrators.</li>
<li>Which sites have sensitive data shared externally.</li>
<li>How recently sites have been used.</li>
<li>The age of sites for lifecycle and archiving decisions.</li>
</ul>
<p>This script addresses these challenges by providing a single, comprehensive report. It allows administrators to identify inactive or outdated sites, review external sharing risks, and ensure that administrative permissions are appropriate. The insights generated help enforce least-privilege access, improve governance, and support compliance audits across the tenant.</p>
<div class="tabGroup" id="tabgroup_1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_1_pnppsV2" role="tab" aria-controls="tabpanel_1_pnppsV2" data-tab="pnppsV2" tabindex="0" aria-selected="true">PnP PowerShell V2</a>
</li>
<li role="presentation">
<a href="#tabpanel_1_pnpps" role="tab" aria-controls="tabpanel_1_pnpps" data-tab="pnpps" tabindex="-1">PnP PowerShell</a>
</li>
</ul>
<section id="tabpanel_1_pnppsV2" role="tabpanel" data-tab="pnppsV2">

<pre><code class="lang-powershell">
param(
    [Parameter(Mandatory=$true)]
    [string]$AdminURL,

    [Parameter(Mandatory=$true)]
    [string]$OutputFile,

    [switch]$IncludeLastActivity,

    [switch]$IncludeExternalSharing
)

# Connect once to Admin Center
Connect-PnPOnline -Url $AdminURL -Interactive

# Get all SharePoint sites once
$sites = Get-PnPTenantSite -IncludeOneDriveSites -Detailed
$results = @()

foreach ($site in $sites) {
    try {
        Write-Host &quot;Processing site: $($site.Url)&quot; -ForegroundColor Green

        # Get site collection admins directly from the tenant-wide site object
        $admins = $site.Owner | ForEach-Object { $_.Title }

        # Storage usage from tenant site object
        $storageSize = $site.StorageUsageCurrent
        $createdDate = $site.CreationDate

        $lastActivity = $null
        $externalSharing = $null

        if ($IncludeLastActivity) {
            # Connect to site once to get last modified item
            Connect-PnPOnline -Url $site.Url -Interactive
            $lastItem = Get-PnPListItem -List &quot;Documents&quot; -PageSize 1 -SortField &quot;Modified&quot; -SortOrder Descending -ErrorAction SilentlyContinue
            if ($lastItem) {
                $lastActivity = $lastItem.FieldValues.Modified
            }
        }

        if ($IncludeExternalSharing) {
            Connect-PnPOnline -Url $site.Url -Interactive
            $externalFiles = Get-PnPSharingForSite -Detailed | Where-Object { $_.SharedWithUsers -match &quot;External&quot; }
            $externalSharing = if ($externalFiles) { &quot;Yes&quot; } else { &quot;No&quot; }
        }

        $siteInfo = [PSCustomObject]@{
            SiteUrl = $site.Url
            SiteName = $site.Title
            Administrators = $admins -join &quot;;&quot;
            StorageSizeMB = $storageSize
            CreatedDate = $createdDate
            LastActivity = $lastActivity
            ExternalSharing = $externalSharing
        }

        $results += $siteInfo
    }
    catch {
        Write-Host &quot;Error processing site $($site.Url): $_&quot; -ForegroundColor Red
    }
}

# Export once
$results | Export-Csv -Path $OutputFile -NoTypeInformation -Encoding UTF8
Disconnect-PnPOnline
Write-Host &quot;Site inventory exported to $OutputFile&quot; -ForegroundColor Green
</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>PnP PowerShell</strong> to learn more at: <a href="https://aka.ms/pnp/powershell">https://aka.ms/pnp/powershell</a></p>
</div>
<div class="highlight-tool">
<p>The way you login into PnP PowerShell has changed please read <a href="https://github.com/pnp/powershell/discussions/4249">PnP Management Shell EntraID app is deleted : what should I do ?</a></p>
</div>
</section>
<section id="tabpanel_1_pnpps" role="tabpanel" data-tab="pnpps" aria-hidden="true" hidden="hidden">

<pre><code class="lang-powershell">
Connect-PnPOnline -Url &quot;https://contoso-admin.sharepoint.com/&quot; -Interactive
        
# Get all SharePoint sites
$sites = Get-PnPTenantSite

# Create an array to store the results
$results = @()

# Iterate through each site and gather required information
foreach ($site in $sites) {
    $siteUrl = $site.Url
    
    Connect-PnPOnline -Url $siteUrl -Interactive

    # Get site administrators
    $admins = Get-PnPSiteCollectionAdmin | Select-Object -ExpandProperty Title

    # Get site storage size
    $storageSize = Get-PnPTenantSite -Url $siteUrl | Select-Object -ExpandProperty StorageUsageCurrent

    # Create a custom object with the site information
    $siteInfo = [PSCustomObject]@{
        SiteUrl = $siteUrl
        Administrators = $admins -join &quot;;&quot;
        StorageSize = $storageSize.ToString() +&quot; MB(s)&quot;
    }

    # Add the site information to the results array
    $results += $siteInfo
}

# Output the results as a CSV file
$results | Export-Csv -Path &quot;SiteInventory.csv&quot; -NoTypeInformation

# Disconnect from SharePoint Online
Disconnect-PnPOnline

</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>PnP PowerShell</strong> to learn more at: <a href="https://aka.ms/pnp/powershell">https://aka.ms/pnp/powershell</a></p>
</div>
<div class="highlight-tool">
<p>The way you login into PnP PowerShell has changed please read <a href="https://github.com/pnp/powershell/discussions/4249">PnP Management Shell EntraID app is deleted : what should I do ?</a></p>
</div>
</section>
</div>
<h2 id="contributors">Contributors</h2>
<table>
<thead>
<tr>
<th>Author(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/Diksha-Bhura">Diksha Bhura</a></td>
</tr>
<tr>
<td><a href="https://github.com/ojopiyo">Josiah Opiyo</a></td>
</tr>
</tbody>
</table>
<h2 id="disclaimer">Disclaimer</h2>
<p><strong>THESE SAMPLES ARE PROVIDED <em>AS IS</em> WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING ANY IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABILITY, OR NON-INFRINGEMENT.</strong></p>
<img src="https://m365-visitor-stats.azurewebsites.net/script-samples/scripts/spo-tenant-site-inventory" aria-hidden="true">

</article>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      <span>Script Samples<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
      
            <!-- <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer"> -->
          </div>
        </div>
      </footer>    </div>

    <script type="text/javascript" src="../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>

    <script type="text/javascript" src="../styles/clipboard.min.js"></script>
    <script type="text/javascript" src="../styles/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="../styles/loadsamples.js"></script>
    <script type="text/javascript" src="../styles/filtersamples.js"></script>

  </body>
</html>