<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>Get and compare documents hash from different tenants | PnP Samples </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="title" content="Get and compare documents hash from different tenants | PnP Samples ">
    <meta name="generator" content="docfx ">
  <meta name="description" content="A sample gallery of scripts to manage all things Microsoft 365.">

    <!-- Social Media -->
    <meta property="og:locale" content="en_GB">
    <meta property="og:title" content="Get and compare documents hash from different tenants | PnP Samples ">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pnp.github.io/script-samples">
    <meta property="og:image" content="https://pnp.github.io/script-samples/assets/social-media-screenshot.png">
    <meta property="og:image:alt" content="Screenshot example of the PnP Script Samples Site">
    <meta property="og:site_name" content="PnP Script Samples">
    <meta name="msvalidate.01" content="04EFEDA66EC42C08A1247C979E2F9ADD">
  <meta property="og:description" content="A sample gallery of scripts to manage all things Microsoft 365.">

    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.min.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/extra.css">
    <link rel="stylesheet" href="../styles/filter.css">
    <link rel="stylesheet" href="../styles/site.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
  
  
  <meta property="docfx:newtab" content="true">
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "8j6pedl344");
  </script>
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
             <div class="github-mark">
              <a href="https://github.com/pnp/script-samples" title="Go to repository">
               <div class="github-wrapper">
                  <div class="github-icon">
                    <img src="https://pnp.github.io/script-samples/assets/icons/github-light-64px.png" alt="GitHub Icon Image">
                  </div>
                  <div class="github-repository">
                    <span>GitHub</span>
                    <ul class="github-facts">
                      <li>
                        <i class="fa fa-code-fork" aria-hidden="true"></i>
                        <span class="github-forks"></span>
                      </li>
                      <li>
                        <i class="fa fa-star-o" aria-hidden="true"></i>
                        <span class="github-stars"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </a>
            </div>
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../assets/logo.svg" alt="">
              </a>            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-12">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/script-samples/blob/main/scripts/spo-compare-files/README.md/#L1" title="Edit this page" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
  <h1 id="get-and-compare-documents-hash-from-different-tenants">Get and compare documents hash from different tenants</h1>

<h2 id="summary">Summary</h2>
<p>This script compares files from two different SharePoint tenants by calculating and comparing their hash values. This is useful for verifying file integrity after migrations or ensuring files are identical across tenants. This sample is available in both PnP PowerShell and CLI for Microsoft 365.</p>
<p>Example of script output of the CLI for Microsoft 365 version:</p>
<p><img src="assets/preview.png" alt="preview CLI for Microsoft 365 output"></p>
<div class="tabGroup" id="tabgroup_1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_1_pnpps" role="tab" aria-controls="tabpanel_1_pnpps" data-tab="pnpps" tabindex="0" aria-selected="true">PnP PowerShell</a>
</li>
<li role="presentation">
<a href="#tabpanel_1_cli-m365-ps" role="tab" aria-controls="tabpanel_1_cli-m365-ps" data-tab="cli-m365-ps" tabindex="-1">CLI for Microsoft 365</a>
</li>
</ul>
<section id="tabpanel_1_pnpps" role="tabpanel" data-tab="pnpps">

<pre><code class="lang-powershell"># Connect to the first tenant
$Connection1 = Connect-PnPOnline -Url &quot;https://[TenantName1].sharepoint.com/sites/[siteName1]&quot; -Interactive -ReturnConnection
$file1 = Get-PnPFile -Url &quot;/Shared%20Documents/document.docx&quot; -AsMemoryStream -Connection $Connection1

# Connect to the first tenant
$Connection2 = Connect-PnPOnline -Url &quot;https://[TenantName2].sharepoint.com/sites/[siteName2]&quot; -Interactive -ReturnConnection
$file2 = Get-PnPFile -Url &quot;/Shared%20Documents/document.docx&quot; -AsMemoryStream -Connection $Connection2


# Compare the hash of the two files
$hash1 = $(Get-FileHash -InputStream $file1).Hash
$hash2 = $(Get-FileHash -InputStream $file2).Hash

# Output the results of the comparison
if ($hash1 -eq $hash2) {
    Write-Host &quot;The two files have the same hash.&quot;
} else {
    Write-Host &quot;The two files have different hashes.&quot;
}

</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>PnP PowerShell</strong> to learn more at: <a href="https://aka.ms/pnp/powershell">https://aka.ms/pnp/powershell</a></p>
</div>
<div class="highlight-tool">
<p>The way you login into PnP PowerShell has changed please read <a href="https://github.com/pnp/powershell/discussions/4249">PnP Management Shell EntraID app is deleted : what should I do ?</a></p>
</div>
</section>
<section id="tabpanel_1_cli-m365-ps" role="tabpanel" data-tab="cli-m365-ps" aria-hidden="true" hidden="hidden">

<pre><code class="lang-powershell">[CmdletBinding()]
param(
    [Parameter(Mandatory, HelpMessage = &quot;URL of the site in first tenant&quot;)]
    [string]$WebUrl1,
    
    [Parameter(Mandatory, HelpMessage = &quot;Server-relative URL of the file in first tenant&quot;)]
    [string]$FileUrl1,
    
    [Parameter(Mandatory, HelpMessage = &quot;URL of the site in second tenant&quot;)]
    [string]$WebUrl2,
    
    [Parameter(HelpMessage = &quot;Server-relative URL of the file in second tenant (defaults to same as FileUrl1)&quot;)]
    [string]$FileUrl2,
    
    [Parameter(HelpMessage = &quot;Name for the first tenant connection (defaults to 'tenant1')&quot;)]
    [string]$Connection1Name = &quot;tenant1&quot;,
    
    [Parameter(HelpMessage = &quot;Name for the second tenant connection (defaults to 'tenant2')&quot;)]
    [string]$Connection2Name = &quot;tenant2&quot;
)

begin {
    if ([string]::IsNullOrEmpty($FileUrl2)) {
        $FileUrl2 = $FileUrl1
    }
    
    Write-Host &quot;Setting up connections to both tenants...&quot; -ForegroundColor Cyan
    
    Write-Host &quot;Logging in to first tenant ($WebUrl1)...&quot; -ForegroundColor Cyan
    m365 login --connectionName $Connection1Name
    if ($LASTEXITCODE -ne 0) {
        throw &quot;Failed to login to first tenant&quot;
    }
    
    Write-Host &quot;Logging in to second tenant ($WebUrl2)...&quot; -ForegroundColor Cyan
    m365 login --connectionName $Connection2Name
    if ($LASTEXITCODE -ne 0) {
        throw &quot;Failed to login to second tenant&quot;
    }
    
    $tempDir = Join-Path $env:TEMP &quot;CompareFiles-$(Get-Date -Format 'yyyyMMddHHmmss')&quot;
    New-Item -ItemType Directory -Path $tempDir -Force | Out-Null
    $tempFile1 = Join-Path $tempDir &quot;file1.tmp&quot;
    $tempFile2 = Join-Path $tempDir &quot;file2.tmp&quot;
}

process {
    try {
        Write-Host &quot;`nSwitching to first tenant connection...&quot; -ForegroundColor Cyan
        m365 connection use --name $Connection1Name | Out-Null
        if ($LASTEXITCODE -ne 0) {
            throw &quot;Failed to switch to first tenant connection&quot;
        }
        
        Write-Host &quot;Downloading file from first tenant: $FileUrl1&quot; -ForegroundColor Cyan
        $result1 = m365 spo file get --webUrl $WebUrl1 --url $FileUrl1 --asFile --path $tempFile1 2&gt;&amp;1
        if ($LASTEXITCODE -ne 0) {
            throw &quot;Failed to download file from first tenant: $result1&quot;
        }
        
        Write-Host &quot;`nSwitching to second tenant connection...&quot; -ForegroundColor Cyan
        m365 connection use --name $Connection2Name | Out-Null
        if ($LASTEXITCODE -ne 0) {
            throw &quot;Failed to switch to second tenant connection&quot;
        }
        
        Write-Host &quot;Downloading file from second tenant: $FileUrl2&quot; -ForegroundColor Cyan
        $result2 = m365 spo file get --webUrl $WebUrl2 --url $FileUrl2 --asFile --path $tempFile2 2&gt;&amp;1
        if ($LASTEXITCODE -ne 0) {
            throw &quot;Failed to download file from second tenant: $result2&quot;
        }
        
        Write-Host &quot;`nCalculating file hashes...&quot; -ForegroundColor Cyan
        $hash1 = (Get-FileHash -Path $tempFile1 -Algorithm SHA256).Hash
        $hash2 = (Get-FileHash -Path $tempFile2 -Algorithm SHA256).Hash
        
        Write-Host &quot;`nComparison Results:&quot; -ForegroundColor White
        Write-Host &quot;==================&quot; -ForegroundColor White
        Write-Host &quot;File 1 ($Connection1Name): $FileUrl1&quot; -ForegroundColor Gray
        Write-Host &quot;Hash 1: $hash1&quot; -ForegroundColor Gray
        Write-Host &quot;`nFile 2 ($Connection2Name): $FileUrl2&quot; -ForegroundColor Gray
        Write-Host &quot;Hash 2: $hash2&quot; -ForegroundColor Gray
        
        Write-Host &quot;`nResult: &quot; -NoNewline
        if ($hash1 -eq $hash2) {
            Write-Host &quot;Files are IDENTICAL&quot; -ForegroundColor Green
        } else {
            Write-Host &quot;Files are DIFFERENT&quot; -ForegroundColor Red
        }
    } finally {
        if (Test-Path $tempDir) {
            Remove-Item -Path $tempDir -Recurse -Force
        }
    }
}

# Example 1: Compare same file across two tenants
# .\Compare-Files.ps1 -WebUrl1 &quot;https://contoso.sharepoint.com/sites/Site1&quot; -FileUrl1 &quot;/Shared Documents/document.docx&quot; -WebUrl2 &quot;https://fabrikam.sharepoint.com/sites/Site2&quot; -Connection1Name &quot;contoso&quot; -Connection2Name &quot;fabrikam&quot;

# Example 2: Compare different file paths
# .\Compare-Files.ps1 -WebUrl1 &quot;https://contoso.sharepoint.com/sites/Site1&quot; -FileUrl1 &quot;/Shared Documents/doc1.pdf&quot; -WebUrl2 &quot;https://fabrikam.sharepoint.com/sites/Site2&quot; -FileUrl2 &quot;/Documents/doc2.pdf&quot;

# Example 3: Compare with default connection names (tenant1, tenant2)
# .\Compare-Files.ps1 -WebUrl1 &quot;https://contoso.sharepoint.com/sites/Site1&quot; -FileUrl1 &quot;/Shared Documents/report.xlsx&quot; -WebUrl2 &quot;https://fabrikam.sharepoint.com/sites/Site2&quot;

</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>CLI for Microsoft 365</strong> to learn more at: <a href="https://aka.ms/cli-m365">https://aka.ms/cli-m365</a></p>
</div>
<div class="highlight-tool-red">
<p>Important changes coming to the way you login into CLI for Microsoft 365 (effective 9th September 2024) see <a href="https://pnp.github.io/blog/post/changes-pnp-management-shell-registration/">Changes in PnP Management Shell registration in Microsoft 365</a></p>
</div>
</section>
</div>
<h2 id="contributors">Contributors</h2>
<table>
<thead>
<tr>
<th>Author(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/ValerasNarbutas">Valeras Narbutas</a></td>
</tr>
<tr>
<td>Adam WÃ³jcik <a href="https://github.com/Adam-it">@Adam-it</a></td>
</tr>
</tbody>
</table>
<h2 id="disclaimer">Disclaimer</h2>
<p><strong>THESE SAMPLES ARE PROVIDED <em>AS IS</em> WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING ANY IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABILITY, OR NON-INFRINGEMENT.</strong></p>
<img src="https://m365-visitor-stats.azurewebsites.net/script-samples/scripts/spo-compare-files" aria-hidden="true">

</article>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      <span>Script Samples<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
      
            <!-- <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer"> -->
          </div>
        </div>
      </footer>    </div>

    <script type="text/javascript" src="../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>

    <script type="text/javascript" src="../styles/clipboard.min.js"></script>
    <script type="text/javascript" src="../styles/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="../styles/loadsamples.js"></script>
    <script type="text/javascript" src="../styles/filtersamples.js"></script>

  </body>
</html>