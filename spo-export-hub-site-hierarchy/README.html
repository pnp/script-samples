<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <title>Export of the Hierarchy of Hub Sites | PnP Samples </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" "="">
    <meta name="title" content="Export of the Hierarchy of Hub Sites | PnP Samples ">
    <meta name="generator" content="docfx 2.56.7.0">
    <meta name="description" content="A sample gallery of scripts to manage all things Microsoft 365.">
  
    <!-- Social Media -->
    <meta property="og:locale" content="en_GB">
    <meta property="og:title" content="Export of the Hierarchy of Hub Sites | PnP Samples ">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pnp.github.io/script-samples">
    <meta property="og:image" content="https://pnp.github.io/script-samples/assets/social-media-screenshot.png">
    <meta property="og:image:alt" content="Screenshot example of the PnP Script Samples Site">
    <meta property="og:site_name" content="PnP Script Samples">
    <meta name="msvalidate.01" content="04EFEDA66EC42C08A1247C979E2F9ADD">
    <meta property="og:description" content="A sample gallery of scripts to manage all things Microsoft 365.">
  
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/extra.css">
    <link rel="stylesheet" href="../styles/filter.css">
    <link rel="stylesheet" href="../styles/site.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    <meta property="docfx:newtab" content="true">
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "8j6pedl344");
  </script>
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
             <div class="github-mark">
              <a href="https://github.com/pnp/script-samples" title="Go to repository">
               <div class="github-wrapper">
                  <div class="github-icon">
                    <img src="https://pnp.github.io/script-samples/assets/icons/github-light-64px.png" alt="GitHub Icon Image">
                  </div>
                  <div class="github-repository">
                    <span>GitHub</span>
                    <ul class="github-facts">
                      <li>
                        <i class="fa fa-code-fork" aria-hidden="true"></i>
                        <span class="github-forks"></span>
                      </li>
                      <li>
                        <i class="fa fa-star-o" aria-hidden="true"></i>
                        <span class="github-stars"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </a>
            </div>
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../assets/logo.svg" alt="">
              </a>    </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-12">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/script-samples/blob/main/scripts/spo-export-hub-site-hierarchy/README.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="export-of-the-hierarchy-of-hub-sites">Export of the Hierarchy of Hub Sites</h1>

<h2 id="summary">Summary</h2>
<p><a href="https://learn.microsoft.com/sharepoint/hub-to-hub-association">SharePoint allows to associate a hub site with another hub site</a>. This script exports the SharePoint site hierarchy into a Markdown file to visualize the hub sites and its associated sites. It helps to understand the structure of SharePoint.</p>
<p><img src="assets/example.png" alt="Screenshot of the example"></p>
<p>The following is a sample of the output markdown:</p>
<pre><code class="lang-markdown"># SharePoint Sites in tenant [contoso]

## Hub Sites and Sites Associated with Hub Sites

Here are the hub sites and the sites associated with the hub sites. Hub sites are shown in bold.

- **[Hub Site A](https://contoso.sharepoint.com/sites/HubSiteA)**
  - [Site 1](https://contoso.sharepoint.com/sites/Site1)
  - [Site 2](https://contoso.sharepoint.com/sites/Site2)
  - **[Hub Site B](https://contoso.sharepoint.com/sites/HubSiteB)**
    - [Site 3](https://contoso.sharepoint.com/sites/Site3)
    - [Site 4](https://contoso.sharepoint.com/sites/Site4)
  - **[Hub Site C](https://contoso.sharepoint.com/sites/HubSiteC)**
    - [Site 5](https://contoso.sharepoint.com/sites/Site5)
    - [Site 6](https://contoso.sharepoint.com/sites/Site6)

- **[Hub Site D](https://contoso.sharepoint.com/sites/HubSiteA)**
  - [Site 7](https://contoso.sharepoint.com/sites/Site7)
  - [Site 8](https://contoso.sharepoint.com/sites/Site8)

## Sites that are not Hub Sites and are not Associated with any Hub Site

Here are the sites that are not hub sites and are not associated with any hub site.

- [Site 9](https://contoso.sharepoint.com/sites/Site9)
- [Site 10](https://contoso.sharepoint.com/sites/Site10)
</code></pre>
<p>The markdown file is created in the &quot;SharePointHubSiteHierarchyReport&quot; folder in MyDocuments.</p>
<p><img src="assets/execution-screen.png" alt="Screenshot of the execution screen"></p>
<div class="NOTE">
<h5>Note</h5>
<ul>
<li>To run this script, it is required to be able to access the SharePoint Tenant Administration site.</li>
<li>Subsites are not exported.</li>
</ul>
</div>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_pnpps" role="tab" aria-controls="tabpanel_CeZOj-G++Q_pnpps" data-tab="pnpps" tabindex="0" aria-selected="true">PnP PowerShell</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_cli-m365-ps" role="tab" aria-controls="tabpanel_CeZOj-G++Q_cli-m365-ps" data-tab="cli-m365-ps" tabindex="-1">CLI for Microsoft 365</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q_pnpps" role="tabpanel" data-tab="pnpps">

<pre><code class="lang-powershell"># Target tenant name
$tenantName = '&lt;Tenant Name&gt;' # e.g. contoso

# Constants
$noHubSiteId = '00000000-0000-0000-0000-000000000000'
$adminUrl = &quot;https://$tenantName-admin.sharepoint.com/&quot;
$exportFolderName = 'SharePointHubSiteHierarchyReport'
$exportFolderPath = Join-Path ([Environment]::GetFolderPath('MyDocuments')) $exportFolderName
$timeStamp = (Get-Date).ToString('yyyyMMdd-HHmmss')
$markdownFilePath = Join-Path $exportFolderPath &quot;$timeStamp-$tenantName.md&quot;

# Function: Generate Markdown
function GenerateMarkdownForHubSite {
    param (
        $hubSite,
        $level,
        $hubSites,
        $tenantSites
    )

    $indent = &quot;  &quot; * ($level - 1)
    $hubSiteInfo = $tenantSites | Where-Object { $_.Url -eq $hubSite.SiteUrl }
    $hubTitle = $hubSiteInfo.Title ? $hubSiteInfo.Title : $hubSiteInfo.Url
    $markdown = &quot;$indent- **[$hubTitle]($($hubSiteInfo.Url))**`r`n&quot;

    $childSites = $tenantSites | Where-Object { $_.HubSiteId -eq $hubSite.SiteId -and $_.Url -ne $hubSite.SiteUrl }
    foreach ($childSite in $childSites) {
        $title = $childSite.Title ? $childSite.Title : $childSite.Url
        $markdown += &quot;$indent  - [$title]($($childSite.Url))`r`n&quot;
    }

    $childHubSites = $hubSites | Where-Object { $_.ParentHubSiteId -eq $hubSite.SiteId }
    foreach ($childHubSite in $childHubSites) {
        $markdown += (GenerateMarkdownForHubSite $childHubSite ($level + 1) $hubSites $tenantSites)
    }

    return $markdown
}

try {
    # Create the Data Export Folder
    if (-not (Test-Path $exportFolderPath -PathType Container)) {
        Write-Host &quot;Creating Data Export Folder...Started&quot; -ForegroundColor Yellow
        New-Item -Path $exportFolderPath -ItemType Directory -Force -ErrorAction Stop
        Write-Host &quot;Creating Data Export Folder...Completed&quot; -ForegroundColor Green
    }

    # Connect to SharePoint site
    Write-Host &quot;Connecting to SharePoint site...Started&quot; -ForegroundColor Yellow
    Connect-PnPOnline -Url $adminUrl -Interactive -ErrorAction Stop
    Write-Host &quot;Connecting to SharePoint site...Completed&quot; -ForegroundColor Green

    # Get tenant sites
    Write-Host &quot;Retrieving tenant sites...Started&quot; -ForegroundColor Yellow
    $tenantSites = Get-PnPTenantSite -ErrorAction Stop
    Write-Host &quot;Retrieving tenant sites...Completed&quot; -ForegroundColor Green

    # Get hub sites
    Write-Host &quot;Retrieving hub sites...Started&quot; -ForegroundColor Yellow
    $hubSites = Get-PnPHubSite -ErrorAction Stop
    Write-Host &quot;Retrieving hub sites...Completed&quot; -ForegroundColor Green

    # Generate Markdown
    Write-Host &quot;Generating markdown...Started&quot; -ForegroundColor Yellow
    $markdownText = @()
    $markdownText += &quot;# SharePoint Sites in tenant [$($tenantName)]`r`n&quot;

    # Hub Sites and Sites Associated with Hub Sites
    $markdownText += &quot;## Hub Sites and Sites Associated with Hub Sites`r`n&quot;
    $markdownText += &quot;Here are the hub sites and the sites associated with the hub sites. Hub sites are shown in bold.`r`n&quot;
    $parentHubSites = $hubSites | Where-Object { $_.ParentHubSiteId -eq $noHubSiteId }
    foreach ($parentHubSite in $parentHubSites) {
        $markdownText += (GenerateMarkdownForHubSite $parentHubSite 1 $hubSites $tenantSites)
    }

    # Hub Sites and Sites Associated with Hub Sites
    $markdownText += &quot;## Sites that are not Hub Sites and are not Associated with any Hub Site`r`n&quot;
    $markdownText += &quot;Here are the sites that are not hub sites and are not associated with any hub site.`r`n&quot;
    $standaloneSites = $tenantSites | Where-Object { $_.HubSiteId -eq $noHubSiteId }
    foreach ($standaloneSite in $standaloneSites) {
        $title = if ($standaloneSite.Title) { $standaloneSite.Title } else { $standaloneSite.Url }
        $markdownText += &quot;- [$title]($($standaloneSite.Url))&quot;
    }
    Write-Host &quot;Generating markdown...Completed&quot; -ForegroundColor Green

    # Save the Markdown file
    Write-Host &quot;Saving markdown file...Started&quot; -ForegroundColor Yellow
    $markdownText -join &quot;`r`n&quot; | Out-File -FilePath $markdownFilePath -Encoding UTF8 -ErrorAction Stop
    Write-Host &quot;Saving markdown file...Completed&quot; -ForegroundColor Green

    # Display successful file save message
    Write-Host &quot;-&quot;.PadRight(50, &quot;-&quot;)
    Write-Host &quot;Markdown file is located at: $markdownFilePath&quot;
    Write-Host &quot;-&quot;.PadRight(50, &quot;-&quot;)
}
catch {
    Write-Error &quot;Error message: $($_.Exception.Message)&quot;
}
finally {
    Disconnect-PnPOnline
}
</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>PnP PowerShell</strong> to learn more at: <a href="https://aka.ms/pnp/powershell">https://aka.ms/pnp/powershell</a></p>
</div>
<div class="highlight-tool">
<p>The way you login into PnP PowerShell has changed please read <a href="https://github.com/pnp/powershell/discussions/4249">PnP Management Shell EntraID app is deleted : what should I do ?</a></p>
</div>
</section>
<section id="tabpanel_CeZOj-G++Q_cli-m365-ps" role="tabpanel" data-tab="cli-m365-ps" aria-hidden="true" hidden="hidden">

<pre><code class="lang-powershell"># Target tenant name
$tenantName = '&lt;Tenant Name&gt;' # e.g. contoso

# Constants
$noHubSiteId = '00000000-0000-0000-0000-000000000000'
$exportFolderName = 'SharePointHubSiteHierarchyReport'
$exportFolderPath = Join-Path ([Environment]::GetFolderPath('MyDocuments')) $exportFolderName
$timeStamp = (Get-Date).ToString('yyyyMMdd-HHmmss')
$markdownFilePath = Join-Path $exportFolderPath &quot;$timeStamp-$tenantName.md&quot;

# Function: Generate Markdown
function GenerateMarkdownForHubSite {
    param (
        $hubSite,
        $level,
        $hubSites,
        $tenantSites
    )

    $indent = &quot;  &quot; * ($level - 1)
    $hubSiteInfo = $tenantSites | Where-Object { $_.Url -eq $hubSite.SiteUrl }
    $hubTitle = $hubSiteInfo.Title ? $hubSiteInfo.Title : $hubSiteInfo.Url
    $markdown = &quot;$indent- **[$hubTitle]($($hubSiteInfo.Url))**`r`n&quot;

    $childSites = $hubSite.AssociatedSites
    foreach ($childSite in $childSites) {
        $title = $childSite.Title ? $childSite.Title : $childSite.Url
        $markdown += &quot;$indent  - [$title]($($childSite.SiteUrl))`r`n&quot;
    }

    $childHubSites = $hubSites | Where-Object { $_.ParentHubSiteId -eq $hubSite.SiteId }
    foreach ($childHubSite in $childHubSites) {
        $markdown += (GenerateMarkdownForHubSite $childHubSite ($level + 1) $hubSites $tenantSites)
    }

    return $markdown
}

try {
    # Create the Data Export Folder
    if (-not (Test-Path $exportFolderPath -PathType Container)) {
        Write-Host &quot;Creating Data Export Folder...Started&quot; -ForegroundColor Yellow
        New-Item -Path $exportFolderPath -ItemType Directory -Force -ErrorAction Stop
        Write-Host &quot;Creating Data Export Folder...Completed&quot; -ForegroundColor Green
    }

    # Connect to SharePoint tenant
    Write-Host &quot;Connecting to SharePoint tenant...Started&quot; -ForegroundColor Yellow
    $m365Status = m365 status
    if ($m365Status -match &quot;Logged Out&quot;) {
        m365 login
    }
    Write-Host &quot;Connecting to SharePoint tenant...Completed&quot; -ForegroundColor Green

    # Get tenant sites
    Write-Host &quot;Retrieving tenant sites...Started&quot; -ForegroundColor Yellow
    $tenantSites = m365 spo site list | ConvertFrom-Json -ErrorAction Stop
    Write-Host &quot;Retrieving tenant sites...Completed&quot; -ForegroundColor Green

    # Get hub sites
    Write-Host &quot;Retrieving hub sites...Started&quot; -ForegroundColor Yellow
    $hubSites = m365 spo hubsite list --includeAssociatedSites | ConvertFrom-Json -ErrorAction Stop
    Write-Host &quot;Retrieving hub sites...Completed&quot; -ForegroundColor Green

    # Generate Markdown
    Write-Host &quot;Generating markdown...Started&quot; -ForegroundColor Yellow
    $markdownText = @()
    $markdownText += &quot;# SharePoint Sites in tenant [$($tenantName)]`r`n&quot;

    # Hub Sites and Sites Associated with Hub Sites
    $markdownText += &quot;## Hub Sites and Sites Associated with Hub Sites`r`n&quot;
    $markdownText += &quot;Here are the hub sites and the sites associated with the hub sites. Hub sites are shown in bold.`r`n&quot;
    $parentHubSites = $hubSites | Where-Object { $_.ParentHubSiteId -eq $noHubSiteId }
    foreach ($parentHubSite in $parentHubSites) {
        $markdownText += (GenerateMarkdownForHubSite $parentHubSite 1 $hubSites $tenantSites)
    }

    # Hub Sites and Sites Associated with Hub Sites
    $markdownText += &quot;## Sites that are not Hub Sites and are not Associated with any Hub Site`r`n&quot;
    $markdownText += &quot;Here are the sites that are not hub sites and are not associated with any hub site.`r`n&quot;
    $standaloneSites = $tenantSites | Where-Object { $_.HubSiteId -eq &quot;/Guid(00000000-0000-0000-0000-000000000000)/&quot; }
    foreach ($standaloneSite in $standaloneSites) {
        $title = if ($standaloneSite.Title) { $standaloneSite.Title } else { $standaloneSite.Url }
        $markdownText += &quot;- [$title]($($standaloneSite.Url))&quot;
    }
    Write-Host &quot;Generating markdown...Completed&quot; -ForegroundColor Green

    # Save the Markdown file
    Write-Host &quot;Saving markdown file...Started&quot; -ForegroundColor Yellow
    $markdownText -join &quot;`r`n&quot; | Out-File -FilePath $markdownFilePath -Encoding UTF8 -ErrorAction Stop
    Write-Host &quot;Saving markdown file...Completed&quot; -ForegroundColor Green

    # Display successful file save message
    Write-Host &quot;-&quot;.PadRight(50, &quot;-&quot;)
    Write-Host &quot;Markdown file is located at: $markdownFilePath&quot;
    Write-Host &quot;-&quot;.PadRight(50, &quot;-&quot;)
}
catch {
    Write-Error &quot;Error message: $($_.Exception.Message)&quot;
}
finally {
    # Disconnect SharePoint online connection
    m365 logout
}
</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>CLI for Microsoft 365</strong> to learn more at: <a href="https://aka.ms/cli-m365">https://aka.ms/cli-m365</a></p>
</div>
<div class="highlight-tool-red">
<p>Important changes coming to the way you login into CLI for Microsoft 365 (effective 9th September 2024) see <a href="https://pnp.github.io/blog/post/changes-pnp-management-shell-registration/">Changes in PnP Management Shell registration in Microsoft 365</a></p>
</div>
</section>
</div>
<h2 id="contributors">Contributors</h2>
<table>
<thead>
<tr>
<th>Author(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/tecchan1107">Tetsuya Kawahara</a></td>
</tr>
<tr>
<td><a href="https://ganeshsanapblogs.wordpress.com/">Ganesh Sanap</a></td>
</tr>
</tbody>
</table>
<h2 id="disclaimer">Disclaimer</h2>
<p><strong>THESE SAMPLES ARE PROVIDED <em>AS IS</em> WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING ANY IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABILITY, OR NON-INFRINGEMENT.</strong></p>
<img src="https://m365-visitor-stats.azurewebsites.net/script-samples/scripts/spo-export-hub-site-hierarchy" aria-hidden="true">
</article>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Script Samples<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
            <!-- <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer"> -->
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    
    <script type="text/javascript" src="../styles/clipboard.min.js"></script>
    <script type="text/javascript" src="../styles/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="../styles/loadsamples.js"></script>
    <script type="text/javascript" src="../styles/filtersamples.js"></script>

  </body>
</html>