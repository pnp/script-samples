<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <title>Create and apply template to Teams Toolkit Declarative Agent | PnP Samples </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="title" content="Create and apply template to Teams Toolkit Declarative Agent | PnP Samples ">
    <meta name="generator" content="docfx 2.56.7.0">
    <meta name="description" content="A sample gallery of scripts to manage all things Microsoft 365.">
  
    <!-- Social Media -->
    <meta property="og:locale" content="en_GB">
    <meta property="og:title" content="Create and apply template to Teams Toolkit Declarative Agent | PnP Samples ">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pnp.github.io/script-samples">
    <meta property="og:image" content="https://pnp.github.io/script-samples/assets/social-media-screenshot.png">
    <meta property="og:image:alt" content="Screenshot example of the PnP Script Samples Site">
    <meta property="og:site_name" content="PnP Script Samples">
    <meta name="msvalidate.01" content="04EFEDA66EC42C08A1247C979E2F9ADD">
    <meta property="og:description" content="A sample gallery of scripts to manage all things Microsoft 365.">
  
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/extra.css">
    <link rel="stylesheet" href="../styles/filter.css">
    <link rel="stylesheet" href="../styles/site.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    <meta property="docfx:newtab" content="true">
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "8j6pedl344");
  </script>
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
             <div class="github-mark">
              <a href="https://github.com/pnp/script-samples" title="Go to repository">
               <div class="github-wrapper">
                  <div class="github-icon">
                    <img src="https://pnp.github.io/script-samples/assets/icons/github-light-64px.png" alt="GitHub Icon Image">
                  </div>
                  <div class="github-repository">
                    <span>GitHub</span>
                    <ul class="github-facts">
                      <li>
                        <i class="fa fa-code-fork" aria-hidden="true"></i>
                        <span class="github-forks"></span>
                      </li>
                      <li>
                        <i class="fa fa-star-o" aria-hidden="true"></i>
                        <span class="github-stars"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </a>
            </div>
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../assets/logo.svg" alt="">
              </a>    </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-12">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/script-samples/blob/main/scripts/copilot-teams-toolkit-da-apply-template/README.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="create-and-apply-template-to-teams-toolkit-declarative-agent">Create and apply template to Teams Toolkit Declarative Agent</h1>

<h2 id="summary">Summary</h2>
<p>When generating a set of templates for a Teams Toolkit Declarative Agent, you may want to apply the template to overlay the default Declarative agent reducing the need to repeat the same changes each time you develop your agent. This starter script will help you do that, as a principle. In theory, you can use a set of scripts to generate many agents with Teams Toolkit CLI.</p>
<p><img src="assets/example.png" alt="Example Screenshot"></p>
<h2 id="prerequisites">Prerequisites</h2>
<p>This script requires the following:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/microsoftteams/platform/toolkit/teams-toolkit-cli?pivots=version-three">Teams Toolkit CLI</a> installed</li>
</ul>
<p>Install the Teams Toolkit CLI using the following command:</p>
<ul>
<li>npm install -g @microsoft/teamsapp-cli</li>
<li>Run to test: teamsapp -h</li>
</ul>
<h2 id="folder-structure">Folder Structure</h2>
<ul>
<li>Base Folder
<ul>
<li>Copilot-Extensibility-Template
<ul>
<li>color.png</li>
<li>manifest.json</li>
<li>declarativeAgent.json</li>
<li>Instruction.md</li>
<li>outline.png</li>
</ul>
</li>
<li>Copilot-Studio-Agent (Just create the folder, the script will populate the contents + the template)
<ul>
<li>appPackage
<ul>
<li>manifest.json</li>
<li>declarativeAgent.json</li>
<li>Instruction.md
...</li>
</ul>
</li>
</ul>
</li>
<li>Other Agent 1</li>
<li>Other Agent 2</li>
<li>Other Agent 3</li>
<li>Other Agent 4</li>
</ul>
</li>
<li>Invoke-CoolScript.ps1</li>
</ul>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_ps" role="tab" aria-controls="tabpanel_CeZOj-G++Q_ps" data-tab="ps" tabindex="0" aria-selected="true">PowerShell - Teams App CLI</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_ps1" role="tab" aria-controls="tabpanel_CeZOj-G++Q_ps1" data-tab="ps1" tabindex="-1">PowerShell - Teams App CLI (Bulk)</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q_ps" role="tabpanel" data-tab="ps">

<pre><code class="lang-powershell"># Name the PowerShell Script Set-TemplateOverlay.ps1
[CmdletBinding()]
param (
    $targetFolderName = &quot;Copilot-Studio-Agent&quot;,
    $appName = &quot;Copilot Studio Agent&quot;,
    $templateFolderAgent = &quot;Copilot-Extensibility-Template&quot;,
    $appShortName = &quot;Copilot-Studio-&quot;
)
begin {

    $targetFolder = Join-Path -Path &quot;$(Get-Location)&quot; -ChildPath &quot;$($targetFolderName)&quot;
    $srcTemplateFolder = Join-Path -Path &quot;$(Get-Location)&quot; -ChildPath &quot;$($templateFolderAgent)&quot;
    
    # ------------------------------------------------------------------------------
    # Introduction
    # ------------------------------------------------------------------------------

    Write-Host &quot;*** This script will generate out the agent, overlay the template and replace the values ***&quot; -ForegroundColor Green
    
    # ------------------------------------------------------------------------------

}
process {

    # ------------------------------------------------------------------------------
    # Create the agent
    # ------------------------------------------------------------------------------
    # Test if the target folder contains teamsapp.yml file
    $teamsAppFile = &quot;teamsapp.yml&quot;
    $teamsAppFilePath = Join-Path -Path $targetFolder -ChildPath $teamsAppFile
    if (Test-Path -Path $teamsAppFilePath) {
        Write-Host &quot;File $teamsAppFile already exists in the target folder.&quot; -ForegroundColor Red
        
    }else{
        Write-Host &quot;Creating the target agent $targetFolder&quot; -ForegroundColor Green
        teamsapp new --capability &quot;declarative-agent&quot; --app-name $appName -folder $targetFolder --interactive false --debug --verbose --with-plugin no 
        Write-Host &quot;Agent $targetFolder created.&quot; -ForegroundColor Cyan

        # Move the agent to the target folder
        $srcFolder = &quot;$(Get-Location)\$($targetFolderName)\$($appName)&quot;
        $destFolder = &quot;$(Get-Location)\$($targetFolderName)&quot;
        if (Test-Path -Path $srcFolder) {
            Write-Host &quot;Moving $srcFolder to $destFolder&quot; -ForegroundColor Green

            Move-Item -Path &quot;$($srcFolder)\*&quot; -Destination $destFolder -Force
            Remove-Item -Path $srcFolder -Recurse -Force
        } else {
            Write-Host &quot;Source folder $srcFolder not found.&quot; -ForegroundColor Red
        }
    }


    # ------------------------------------------------------------------------------
    # Copy key template files
    # ------------------------------------------------------------------------------
    
    $filesToCopy = @(
        &quot;manifest.json&quot;,
        &quot;declarativeAgent.json&quot;,
        &quot;Instruction.md&quot;
    )

    $targetAppFolder = Join-Path -Path $targetFolder -ChildPath &quot;appPackage&quot;

    # Copy the files to the output location
    foreach ($file in $filesToCopy) {
        $srcFilePath = Join-Path -Path $srcTemplateFolder -ChildPath $file
        
        if (Test-Path -Path $srcFilePath) {
            Write-Host &quot;Copying $file to $targetAppFolder&quot; -ForegroundColor Green
            Copy-Item -Path $srcFilePath -Destination $targetAppFolder -Force
        } else {
            Write-Host &quot;File $file not found in the template package.&quot; -ForegroundColor Red
        }
    }

    $filesToRemoveTarget = @(
        
        &quot;appPackage/Instruction.txt&quot;
    )

    # Remove the files from the target folder
    foreach ($file in $filesToRemoveTarget) {
        $srcFilePath = Join-Path -Path $targetFolder -ChildPath $file
        
        if (Test-Path -Path $srcFilePath) {
            Write-Host &quot;Removing $file from the target folder&quot; -ForegroundColor Green
            Remove-Item -Path $srcFilePath -Force
        } else {
            Write-Host &quot;File $file not found in the target folder.&quot; -ForegroundColor Red
        }
    }

    # ------------------------------------------------------------------------------
    # Update Template Values in the target folder
    # ------------------------------------------------------------------------------

    $valuesToReplace = @(
        @{ &quot;file&quot; = &quot;manifest.json&quot;; &quot;oldValue&quot; = &quot;{{TMP_APP_NAME}}&quot;; &quot;newValue&quot; = $appName }
        @{ &quot;file&quot; = &quot;manifest.json&quot;; &quot;oldValue&quot; = &quot;{{TMP_APP_SHORT_NAME}}&quot;; &quot;newValue&quot; = $appShortName }
        @{ &quot;file&quot; = &quot;declarativeAgent.json&quot;; &quot;oldValue&quot; = &quot;{{TMP_APP_NAME}}&quot;; &quot;newValue&quot; = $appName }
    )

    $targetAppFolder = Join-Path -Path $targetFolder -ChildPath &quot;appPackage&quot;

    # Loop the files in the target location, read the content, and replace the values, update the file
    foreach ($fileToUpdate in $valuesToReplace) {
        $srcFilePath = Join-Path -Path $targetAppFolder -ChildPath $fileToUpdate.file
        
        if (Test-Path -Path $srcFilePath) {
            Write-Host &quot;Updating $($fileToUpdate.file) in the target folder&quot; -ForegroundColor Green
            (Get-Content -Path $srcFilePath) -replace $fileToUpdate.oldValue, $fileToUpdate.newValue | Set-Content -Path $srcFilePath
        } else {
            Write-Host &quot;File $($fileToUpdate.file) not found in the target folder.&quot; -ForegroundColor Red
        }
    }
    
}
end{

  Write-Host &quot;Done! :)&quot; -ForegroundColor Green
}

</code></pre>
</section>
<section id="tabpanel_CeZOj-G++Q_ps1" role="tabpanel" data-tab="ps1" aria-hidden="true" hidden="hidden">

<pre><code class="lang-powershell">Read-Host -Prompt &quot;This script will set the template overlay for all folders in the current directory. Press Enter to continue or Ctrl+C to cancel.&quot;

.\Set-TemplateOverlay.ps1 -targetFolderName &quot;Copilot-Studio-Agent&quot; -appName &quot;Copilot Studio Agent&quot; -appShortName &quot;Copilot-Studio-&quot;
.\Set-TemplateOverlay.ps1 -targetFolderName &quot;Other-Agent-1&quot; -appName &quot;Other Agent 1&quot; -appShortName &quot;Other-Agent-1-&quot;
.\Set-TemplateOverlay.ps1 -targetFolderName &quot;Other-Agent-2&quot; -appName &quot;Other Agent 2&quot; -appShortName &quot;Other-Agent-2-&quot;
.\Set-TemplateOverlay.ps1 -targetFolderName &quot;Other-Agent-3&quot; -appName &quot;Other Agent 3&quot; -appShortName &quot;Other-Agent-3-&quot;
.\Set-TemplateOverlay.ps1 -targetFolderName &quot;Other-Agent-4&quot; -appName &quot;Other Agent 4&quot; -appShortName &quot;Other-Agent-4-&quot;
</code></pre>
</section>
</div>
<div class="highlight-tool">
<p>Check out the <strong>Microsoft Teams Toolkit CLI</strong> to learn more at: <a href="https://learn.microsoft.com/en-us/microsoftteams/platform/toolkit/teams-toolkit-cli?pivots=version-three">https://learn.microsoft.com/en-us/microsoftteams/platform/toolkit/teams-toolkit-cli?pivots=version-three</a></p>
</div>
<h2 id="template-files">Template Files</h2>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_json1" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_json1" data-tab="json1" tabindex="0" aria-selected="true">JSON - declarativeAgent.json </a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_json2" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_json2" data-tab="json2" tabindex="-1">JSON - instruction.md </a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_json3" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_json3" data-tab="json3" tabindex="-1">JSON - manifest.json </a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-1_json1" role="tabpanel" data-tab="json1">

<pre><code class="lang-json">{
    &quot;$schema&quot;: &quot;https://developer.microsoft.com/json-schemas/copilot/declarative-agent/v1.3/schema.json&quot;,
    &quot;version&quot;: &quot;v1.3&quot;,
    &quot;name&quot;: &quot;{{TMP_APP_NAME}}&quot;,
    &quot;description&quot;: &quot;Declarative agent example for learning about Copilot Studio&quot;,
    &quot;instructions&quot;: &quot;$[file('instruction.md')]&quot;,
    &quot;capabilities&quot;: [
        {
            &quot;name&quot;: &quot;WebSearch&quot;,
            &quot;sites&quot;: [
                {
                    &quot;url&quot;: &quot;https://learn.microsoft.com/en-us/microsoft-copilot-studio&quot;
                }
            ]
        }
    ]
}
</code></pre>
</section>
<section id="tabpanel_CeZOj-G++Q-1_json2" role="tabpanel" data-tab="json2" aria-hidden="true" hidden="hidden">

<pre><code class="lang-json">You are a declarative agent and were created to support developers in extending and developing agents for Microsoft 365 Copilot. 
</code></pre>
</section>
<section id="tabpanel_CeZOj-G++Q-1_json3" role="tabpanel" data-tab="json3" aria-hidden="true" hidden="hidden">

<pre><code class="lang-json">{
  &quot;$schema&quot;: &quot;https://developer.microsoft.com/json-schemas/teams/v1.19/MicrosoftTeams.schema.json&quot;,
  &quot;manifestVersion&quot;: &quot;1.19&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;id&quot;: &quot;${{TEAMS_APP_ID}}&quot;,
  &quot;developer&quot;: {
    &quot;name&quot;: &quot;PKB App, Inc.&quot;,
    &quot;websiteUrl&quot;: &quot;https://pkbullock.com&quot;,
    &quot;privacyUrl&quot;: &quot;https://pkbullock.com&quot;,
    &quot;termsOfUseUrl&quot;: &quot;https://pkbullock.com&quot;
  },
  &quot;icons&quot;: {
    &quot;color&quot;: &quot;color.png&quot;,
    &quot;outline&quot;: &quot;outline.png&quot;
  },
  &quot;name&quot;: {
    &quot;short&quot;: &quot;{{TMP_APP_SHORT_NAME}}${{APP_NAME_SUFFIX}}&quot;,
    &quot;full&quot;: &quot;{{TMP_APP_NAME}}&quot;
  },
  &quot;description&quot;: {
    &quot;short&quot;: &quot;Agent to support {{TMP_APP_NAME}}&quot;,
    &quot;full&quot;: &quot;Agent to support {{TMP_APP_NAME}} learning about Copilot Studio&quot;
  },
  &quot;accentColor&quot;: &quot;#FFFFFF&quot;,
  &quot;composeExtensions&quot;: [],
  &quot;permissions&quot;: [
    &quot;identity&quot;,
    &quot;messageTeamMembers&quot;
  ],
  &quot;copilotAgents&quot;: {
    &quot;declarativeAgents&quot;: [
      {
        &quot;id&quot;: &quot;declarativeAgent&quot;,
        &quot;file&quot;: &quot;declarativeAgent.json&quot;
      }
    ]
  },
  &quot;validDomains&quot;: []
}
</code></pre>
</section>
</div>
<h2 id="source-blog-article">Source Blog Article</h2>
<ul>
<li><a href="https://pkbullock.com/blog/2025/create-declarative-agent-with-teams-toolkit-cli">Create Microsoft 365 Copilot declarative agents with Teams Toolkit CLI | pkbullock.com</a></li>
</ul>
<h2 id="contributors">Contributors</h2>
<table>
<thead>
<tr>
<th>Author(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Paul Bullock</td>
</tr>
</tbody>
</table>
<h2 id="disclaimer">Disclaimer</h2>
<p><strong>THESE SAMPLES ARE PROVIDED <em>AS IS</em> WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING ANY IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABILITY, OR NON-INFRINGEMENT.</strong></p>
<img src="https://m365-visitor-stats.azurewebsites.net/script-samples/scripts/copilot-teams-toolkit-da-apply-template" aria-hidden="true">
</article>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Script Samples<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
            <!-- <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer"> -->
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    
    <script type="text/javascript" src="../styles/clipboard.min.js"></script>
    <script type="text/javascript" src="../styles/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="../styles/loadsamples.js"></script>
    <script type="text/javascript" src="../styles/filtersamples.js"></script>

  </body>
</html>